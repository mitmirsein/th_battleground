<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³„ì‹œ ë…¼ìŸì˜ 3ëŒ€ ì „ì„ : ì‹ í•™ ìƒí™©ì‹¤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;600;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .custom-scroll::-webkit-scrollbar {
            width: 5px;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .layer-item {
            transition: all 0.2s;
        }

        .layer-item.inactive {
            opacity: 0.35;
        }

        .layer-item:hover {
            background: #f1f5f9;
        }

        .layer-item.selected {
            background: #e0e7ff;
        }

        .step-pill {
            transition: all 0.3s;
            cursor: pointer;
        }

        .step-pill:hover {
            background: #e0e7ff;
        }

        .step-pill.active {
            background: #4f46e5;
            color: white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
        }
    </style>
</head>

<body
    class="min-h-screen flex flex-col bg-gradient-to-br from-slate-100 via-slate-50 to-indigo-50 text-slate-800 overflow-x-hidden">

    <!-- í—¤ë” -->
    <header
        class="h-14 lg:h-16 bg-white/80 backdrop-blur-lg border-b border-slate-200/50 z-50 px-4 lg:px-6 flex justify-between items-center shrink-0">
        <div class="flex items-center gap-2 lg:gap-3">
            <span class="text-xl lg:text-2xl">ğŸ“–</span>
            <div>
                <h1 class="text-sm lg:text-lg font-extrabold text-slate-900 tracking-tight">ê³„ì‹œ ë…¼ìŸì˜ 3ëŒ€ ì „ì„ </h1>
                <p class="text-[10px] text-slate-400 font-medium tracking-widest uppercase hidden sm:block">Revelation
                    Warfare Map</p>
            </div>
        </div>
        <div id="progress-bar" class="hidden lg:flex items-center gap-1 bg-slate-100 rounded-full px-2 py-1"></div>
        <div class="flex items-center gap-2">
            <button onclick="switchMode('story')" id="btn-mode-story"
                class="px-3 lg:px-4 py-1.5 lg:py-2 text-xs lg:text-sm font-bold rounded-full bg-indigo-600 text-white shadow-md">ìŠ¤í† ë¦¬</button>
            <button onclick="switchMode('custom')" id="btn-mode-custom"
                class="px-3 lg:px-4 py-1.5 lg:py-2 text-xs lg:text-sm font-bold rounded-full bg-slate-200 text-slate-600 hover:bg-slate-300">ë¹„êµ</button>
        </div>
    </header>

    <!-- ëª¨ë°”ì¼ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="lg:hidden flex border-b border-slate-200 bg-white/90">
        <button onclick="showMobileTab('chart')" id="tab-chart"
            class="flex-1 py-2 text-xs font-bold text-center border-b-2 border-indigo-500 text-indigo-600">ì°¨íŠ¸</button>
        <button onclick="showMobileTab('layers')" id="tab-layers"
            class="flex-1 py-2 text-xs font-bold text-center border-b-2 border-transparent text-slate-400">ë ˆì´ì–´</button>
        <button onclick="showMobileTab('story')" id="tab-story"
            class="flex-1 py-2 text-xs font-bold text-center border-b-2 border-transparent text-slate-400">ìŠ¤í† ë¦¬</button>
    </div>

    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden">
        <!-- ì¢Œì¸¡: ë ˆì´ì–´ ì„ íƒ íŒ¨ë„ -->
        <aside id="panel-layers"
            class="hidden lg:flex w-full lg:w-72 bg-white/95 backdrop-blur-md border-r border-slate-200 flex-col shrink-0 overflow-hidden">
            <div class="p-4 border-b border-slate-100 shrink-0">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider">ë ˆì´ì–´ ì„ íƒ</h3>
                <p id="layer-mode-hint" class="text-[10px] text-slate-400 mt-1">ìŠ¤í† ë¦¬ ëª¨ë“œ: ìë™ ì§„í–‰</p>
            </div>
            <div class="flex-1 overflow-y-auto custom-scroll p-3 space-y-4">
                <div>
                    <h4 class="text-[10px] font-bold text-slate-300 uppercase mb-2">ê³ ëŒ€ ë°°ê²½</h4>
                    <div id="layer-roots" class="space-y-1"></div>
                </div>
                <div>
                    <h4 class="text-[10px] font-bold text-slate-300 uppercase mb-2">êµë¶€ & ì¤‘ì„¸</h4>
                    <div id="layer-medieval" class="space-y-1"></div>
                </div>
                <div>
                    <h4 class="text-[10px] font-bold text-slate-300 uppercase mb-2">ì¢…êµê°œí˜</h4>
                    <div id="layer-reformation" class="space-y-1"></div>
                </div>
                <div>
                    <h4 class="text-[10px] font-bold text-slate-300 uppercase mb-2">ê·¼í˜„ëŒ€</h4>
                    <div id="layer-modern" class="space-y-1"></div>
                </div>
            </div>
        </aside>

        <!-- ì¤‘ì•™: ì°¨íŠ¸ -->
        <div id="panel-chart"
            class="flex-1 flex items-center justify-center p-4 lg:p-6 relative min-h-[50vh] lg:min-h-0">
            <div class="relative w-full max-w-sm lg:max-w-[75vh] aspect-square">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-indigo-200/30 to-pink-200/30 rounded-[24px] lg:rounded-[40px] blur-2xl">
                </div>
                <div
                    class="relative bg-white rounded-[20px] lg:rounded-[32px] shadow-2xl border border-slate-100 p-3 lg:p-4 h-full">
                    <canvas id="theologyChart" class="w-full h-full"></canvas>
                </div>
            </div>
        </div>

        <!-- ìš°ì¸¡: ìŠ¤í† ë¦¬ + ì¸ì‚¬ì´íŠ¸ -->
        <aside id="panel-story"
            class="hidden lg:flex w-full lg:w-96 bg-white border-l border-slate-200 flex-col shrink-0 overflow-hidden max-h-[50vh] lg:max-h-full">
            <div class="flex-[7] flex flex-col overflow-hidden border-b border-slate-200">
                <div class="p-3 lg:p-4 border-b border-slate-100 shrink-0 flex items-center gap-2">
                    <span id="detail-badge"
                        class="px-3 py-1 rounded-full text-xs font-bold bg-indigo-100 text-indigo-700">Overview</span>
                    <h2 id="detail-title" class="text-base lg:text-lg font-bold text-slate-900"></h2>
                </div>
                <div id="detail-desc"
                    class="flex-1 overflow-y-auto custom-scroll p-4 prose prose-slate prose-sm max-w-none"></div>
            </div>
            <div class="flex-[3] flex flex-col overflow-hidden bg-gradient-to-b from-indigo-50/50 to-purple-50/50">
                <div class="flex items-center justify-between px-3 lg:px-4 py-2 border-b border-indigo-100 shrink-0">
                    <div class="flex items-center gap-2">
                        <span class="text-lg">ğŸ’¡</span>
                        <span class="text-[10px] lg:text-xs font-bold text-indigo-600 uppercase">AI Insight</span>
                    </div>
                    <span id="insight-badge"
                        class="text-[10px] font-semibold px-2 py-0.5 rounded-full bg-amber-100 text-amber-700">Step
                        1/14</span>
                </div>
                <div class="flex-1 overflow-y-auto custom-scroll p-3 lg:p-4 min-h-0">
                    <div id="insight-text" class="text-sm text-slate-700 leading-relaxed"></div>
                </div>
                <div id="story-nav" class="flex border-t border-indigo-100 shrink-0">
                    <button onclick="prevStep()" id="btn-prev"
                        class="flex-1 py-2 text-sm font-semibold text-slate-400 hover:bg-white/50 disabled:opacity-30">â†
                        ì´ì „</button>
                    <button onclick="nextStep()" id="btn-next"
                        class="flex-1 py-2 text-sm font-semibold text-indigo-600 hover:bg-white/50 border-l border-indigo-100">ë‹¤ìŒ
                        â†’</button>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // ëª¨ë°”ì¼ íƒ­ ì „í™˜
        function showMobileTab(tab) {
            const tabs = ['chart', 'layers', 'story'];
            tabs.forEach(t => {
                const panel = document.getElementById('panel-' + t);
                const tabBtn = document.getElementById('tab-' + t);
                if (t === tab) {
                    panel.classList.remove('hidden');
                    panel.classList.add('flex');
                    tabBtn.classList.add('border-indigo-500', 'text-indigo-600');
                    tabBtn.classList.remove('border-transparent', 'text-slate-400');
                } else {
                    if (window.innerWidth < 1024) {
                        panel.classList.add('hidden');
                        panel.classList.remove('flex');
                    }
                    tabBtn.classList.remove('border-indigo-500', 'text-indigo-600');
                    tabBtn.classList.add('border-transparent', 'text-slate-400');
                }
            });
        }

        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                document.getElementById('panel-layers').classList.remove('hidden');
                document.getElementById('panel-layers').classList.add('flex');
                document.getElementById('panel-chart').classList.remove('hidden');
                document.getElementById('panel-chart').classList.add('flex');
                document.getElementById('panel-story').classList.remove('hidden');
                document.getElementById('panel-story').classList.add('flex');
            } else {
                // ëª¨ë°”ì¼ë¡œ ì „í™˜ ì‹œ: ì°¨íŠ¸ë§Œ ë³´ì´ê³  ë‚˜ë¨¸ì§€ ìˆ¨ê¹€
                document.getElementById('panel-layers').classList.add('hidden');
                document.getElementById('panel-layers').classList.remove('flex');
                document.getElementById('panel-story').classList.add('hidden');
                document.getElementById('panel-story').classList.remove('flex');
                document.getElementById('panel-chart').classList.remove('hidden');
                document.getElementById('panel-chart').classList.add('flex');
                // íƒ­ ìƒíƒœ ì´ˆê¸°í™”
                document.getElementById('tab-chart').classList.add('border-indigo-500', 'text-indigo-600');
                document.getElementById('tab-chart').classList.remove('border-transparent', 'text-slate-400');
                document.getElementById('tab-layers').classList.remove('border-indigo-500', 'text-indigo-600');
                document.getElementById('tab-layers').classList.add('border-transparent', 'text-slate-400');
                document.getElementById('tab-story').classList.remove('border-indigo-500', 'text-indigo-600');
                document.getElementById('tab-story').classList.add('border-transparent', 'text-slate-400');
            }
        });
        // ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í™”ëœ 7ì¶•
        const labels = [
            ['ğŸ”µ ìì—° ê³„ì‹œ', '12ì‹œ'],
            ['ğŸ”µ ì—­ì‚¬ì  ê°ê´€ì„±', '2ì‹œ'],
            ['ğŸ”µ ìš°ì£¼ì  ë²”ìœ„', '4ì‹œ'],
            ['ğŸ”´ ì‹¤ì¡´ì  ë§Œë‚¨', '5ì‹œ'],
            ['ğŸ”´ í˜„ì¬ì  ë§ì”€', '7ì‹œ'],
            ['ğŸŸ¢ ì„±ê²½ ì¤‘ì‹¬ì„±', '9ì‹œ'],
            ['ğŸŸ¢ ì‹ ë¹„/ì´ˆì›”', '11ì‹œ']
        ];
        const axisMeanings = [
            { name: "ìì—° ê³„ì‹œ", desc: "ì´ì„±ê³¼ ìì—°ì„ í†µí•œ ì•", cat: "ê°ê´€" },
            { name: "ì—­ì‚¬ì  ê°ê´€ì„±", desc: "ê²€ì¦ ê°€ëŠ¥í•œ ì—­ì‚¬ì  ì‚¬ê±´", cat: "ê°ê´€" },
            { name: "ìš°ì£¼ì  ë²”ìœ„", desc: "í”¼ì¡°ì„¸ê³„ ì „ì²´ í¬ê´„", cat: "ê°ê´€" },
            { name: "ì‹¤ì¡´ì  ë§Œë‚¨", desc: "ì£¼ê´€ì  ê²°ë‹¨ê³¼ ë§Œë‚¨", cat: "ì£¼ê´€" },
            { name: "í˜„ì¬ì  ë§ì”€", desc: "ì˜¤ëŠ˜ë„ ë§ì”€í•˜ì‹œëŠ” í•˜ë‚˜ë‹˜", cat: "ì£¼ê´€" },
            { name: "ì„±ê²½ ì¤‘ì‹¬ì„±", desc: "ì„±ê²½ì´ ìœ ì¼í•œ ê·œë²”", cat: "ì´ˆì›”" },
            { name: "ì‹ ë¹„/ì´ˆì›”", desc: "ì—¬ì „íˆ ì‹ ë¹„ë¡œ ë‚¨ëŠ” í•˜ë‚˜ë‹˜", cat: "ì´ˆì›”" }
        ];

        const allLayers = {
            // data ìˆœì„œ: [ìì—°ê³„ì‹œ, ì—­ì‚¬ì ê°ê´€ì„±, ìš°ì£¼ì ë²”ìœ„, ì‹¤ì¡´ì ë§Œë‚¨, í˜„ì¬ì ë§ì”€, ì„±ê²½ì¤‘ì‹¬ì„±, ì‹ ë¹„ì´ˆì›”]
            hellenism: { id: 'hellenism', label: 'í—¬ë¼ ì² í•™', desc: 'ë¡œê³ ìŠ¤ì™€ ì´ì„±', data: [5, 2, 4, 3, 1, 1, 2], borderColor: '#64748b', type: 'root' },
            judaism: { id: 'judaism', label: 'ìœ ëŒ€êµ', desc: 'í† ë¼ì™€ ì—­ì‚¬', data: [2, 5, 3, 2, 3, 5, 5], borderColor: '#eab308', type: 'root' },
            irenaeus: { id: 'irenaeus', label: 'ì´ë ˆë„¤ìš°ìŠ¤', desc: 'ì´ê´„ê°±ì‹ ', data: [3, 4, 5, 3, 3, 5, 4], borderColor: '#8B4513', type: 'medieval' },
            augustine: { id: 'augustine', label: 'ì•„ìš°êµ¬ìŠ¤í‹°ëˆ„ìŠ¤', desc: 'ë‚´ë©´ì˜ ë¹›', data: [4, 4, 3, 5, 4, 5, 5], borderColor: '#d97706', type: 'medieval' },
            aquinas: { id: 'aquinas', label: 'ì•„í€´ë‚˜ìŠ¤', desc: 'ìì—°ê³¼ ì€ì´', data: [5, 4, 5, 2, 2, 4, 3], borderColor: '#1e3a8a', type: 'medieval' },
            luther: { id: 'luther', label: 'ë£¨í„°', desc: 'ì˜¤ì§ ë§ì”€', data: [1, 3, 2, 5, 5, 5, 4], borderColor: '#be123c', type: 'reformation' },
            calvin: { id: 'calvin', label: 'ì¹¼ë±…', desc: 'ì„±ë ¹ì˜ ì¦ê±°', data: [2, 4, 4, 4, 4, 5, 5], borderColor: '#155e75', type: 'reformation' },
            schleiermacher: { id: 'schleiermacher', label: 'ìŠë¼ì´ì–´ë§ˆí—ˆ', desc: 'ê°ì • ì˜ì¡´', data: [3, 1, 2, 5, 4, 2, 3], borderColor: '#ec4899', type: 'modern' },
            barth: { id: 'barth', label: 'ë°”ë¥´íŠ¸', desc: 'ë§ì”€ì˜ ì‚¼ì¤‘í˜•íƒœ', data: [1, 3, 3, 3, 5, 5, 5], borderColor: '#16a34a', type: 'modern' },
            bultmann: { id: 'bultmann', label: 'ë¶ˆíŠ¸ë§Œ', desc: 'ì‹¤ì¡´ì  í•´ì„', data: [1, 1, 1, 5, 4, 3, 2], borderColor: '#2563eb', type: 'modern' },
            bonhoeffer: { id: 'bonhoeffer', label: 'ë³¸íšŒí¼', desc: 'ë¹„ì¢…êµì  í•´ì„', data: [2, 3, 3, 5, 5, 4, 4], borderColor: '#9333ea', type: 'modern' },
            pannenberg: { id: 'pannenberg', label: 'íŒë„¨ë² ë¥´í¬', desc: 'ì—­ì‚¬ë¡œì„œì˜ ê³„ì‹œ', data: [4, 5, 5, 1, 2, 4, 2], borderColor: '#dc2626', type: 'modern' }
        };

        function getDataset(key) {
            const l = allLayers[key];
            return { label: l.label, data: l.data, backgroundColor: l.borderColor + '15', borderColor: l.borderColor, borderWidth: l.type === 'root' ? 1.5 : 2.5, borderDash: l.type === 'root' ? [5, 5] : [], pointRadius: 3 };
        }

        // ì¸ì‚¬ì´íŠ¸ ì—”ì§„
        function generateInsight(ids) {
            if (ids.length === 0) return "ë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”.";
            if (ids.length === 1) return '<strong>' + allLayers[ids[0]].label + ':</strong> ' + allLayers[ids[0]].desc;
            if (ids.length === 2) {
                const l1 = allLayers[ids[0]], l2 = allLayers[ids[1]];
                let maxDiff = 0, maxIdx = 0;
                for (let i = 0; i < 7; i++) { const d = Math.abs(l1.data[i] - l2.data[i]); if (d > maxDiff) { maxDiff = d; maxIdx = i; } }
                return '<strong>ê²°ì •ì  ì „ì„  [' + axisMeanings[maxIdx].name + ']:</strong> ' + l1.label + '(' + l1.data[maxIdx] + 'ì ) vs ' + l2.label + '(' + l2.data[maxIdx] + 'ì )';
            }
            const layers = ids.map(id => allLayers[id]);
            const avgs = new Array(7).fill(0);
            for (let i = 0; i < 7; i++) { layers.forEach(l => avgs[i] += l.data[i]); avgs[i] /= layers.length; }
            const maxIdx = avgs.indexOf(Math.max(...avgs));
            const minIdx = avgs.indexOf(Math.min(...avgs));
            return '<strong>ê³µí†µì :</strong> ' + axisMeanings[maxIdx].name + '(' + avgs[maxIdx].toFixed(1) + 'ì ). <strong>ë§¹ì :</strong> ' + axisMeanings[minIdx].name + '(' + avgs[minIdx].toFixed(1) + 'ì ).';
        }

        // ìŠ¤í† ë¦¬ ë°ì´í„°
        const storyInsights = [
            "ê³„ì‹œ ë…¼ìŸì€ <strong>ğŸ”µê°ê´€, ğŸ”´ì£¼ê´€, ğŸŸ¢ì´ˆì›”</strong>ì˜ ì„¸ ì „ì„ ì—ì„œ ë²Œì–´ì§‘ë‹ˆë‹¤.",
            "í—¬ë¼ ì² í•™: <strong>ì´ì„±(Logos)</strong>ìœ¼ë¡œ ì‹ ì ì¸ ê²ƒì„ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.",
            "ìœ ëŒ€êµ: í•˜ë‚˜ë‹˜ì€ <strong>ì—­ì‚¬ ì†ì—ì„œ ë§ì”€í•˜ì‹œëŠ” ë¶„</strong>ì…ë‹ˆë‹¤.",
            "ì´ë ˆë„¤ìš°ìŠ¤: ì˜ì§€ì£¼ì˜ì— ë§ì„œ <strong>ê³µì  ì‚¬ë„ ì „ìŠ¹</strong>ì„ ê°•ì¡°.",
            "ì•„ìš°êµ¬ìŠ¤í‹°ëˆ„ìŠ¤: <strong>ë‚´ë©´ì˜ ë¹›</strong>ì„ í†µí•œ ê³„ì‹œ.",
            "ì•„í€´ë‚˜ìŠ¤: <strong>ìì—°ê³¼ ì€ì´ì˜ ì¡°í™”</strong>.",
            "ë£¨í„°: <strong>ì˜¤ì§ ë§ì”€!</strong>",
            "ì¹¼ë±…: <strong>ì„±ë ¹ì˜ ë‚´ì  ì¦ê±°</strong>.",
            "ìŠë¼ì´ì–´ë§ˆí—ˆ: <strong>ì ˆëŒ€ ì˜ì¡´ì˜ ê°ì •</strong>.",
            "ë°”ë¥´íŠ¸: <strong>Nein!</strong> ì˜¤ì§ ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„ ì•ˆì—ì„œë§Œ.",
            "ë¶ˆíŠ¸ë§Œ: <strong>ì¼€ë¦¬ê·¸ë§ˆì™€ì˜ ì‹¤ì¡´ì  ë§Œë‚¨</strong>.",
            "ë³¸íšŒí¼: <strong>ë¹„ì¢…êµì  í•´ì„</strong>.",
            "íŒë„¨ë² ë¥´í¬: <strong>ì—­ì‚¬ë¡œì„œì˜ ê³„ì‹œ</strong>.",
            "12ê°œ ë ˆì´ì–´ê°€ í¼ì³ì¡ŒìŠµë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì¢Œí‘œëŠ”?"
        ];

        const stepDescriptions = [
            '<h3 class="font-bold text-lg mb-3">ğŸ—ºï¸ ê³„ì‹œ ë…¼ìŸì˜ ì§€í˜•ë„</h3><p class="mb-4">"í•˜ë‚˜ë‹˜ì€ ì–´ë–»ê²Œ ìì‹ ì„ ì•Œë¦¬ì‹œëŠ”ê°€?"</p><div class="space-y-3 mb-4"><div class="p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400"><strong class="text-blue-800">ğŸ”µ ê°ê´€ì„±</strong><p class="text-sm text-blue-700">ì´ì„±/ì—­ì‚¬ë¡œ ê²€ì¦ ê°€ëŠ¥í•œê°€?</p></div><div class="p-3 bg-pink-50 rounded-lg border-l-4 border-pink-400"><strong class="text-pink-800">ğŸ”´ ì£¼ê´€ì„±</strong><p class="text-sm text-pink-700">ì‹¤ì¡´ì  ë§Œë‚¨ì¸ê°€?</p></div><div class="p-3 bg-emerald-50 rounded-lg border-l-4 border-emerald-400"><strong class="text-emerald-800">ğŸŸ¢ ì´ˆì›”ì„±</strong><p class="text-sm text-emerald-700">ì‹ ë¹„ë¡œ ë‚¨ëŠ”ê°€?</p></div></div>',
            '<h3 class="font-bold text-lg mb-3">ğŸ›ï¸ í—¬ë¼ ì² í•™</h3><p>í”Œë¼í†¤ ì´ë˜ ê·¸ë¦¬ìŠ¤ ì² í•™ì€ <strong>ë¡œê³ ìŠ¤(ì´ì„±)</strong>ë¥¼ í†µí•´ ì‹ ì ì¸ ê²ƒì„ íŒŒì•…í•  ìˆ˜ ìˆë‹¤ê³  ë³´ì•˜ìŠµë‹ˆë‹¤.</p><ul class="list-disc list-inside text-sm mt-3"><li>ìì—° ê³„ì‹œ ê·¹ëŒ€í™”</li><li>ì˜ì›í•œ ì§„ë¦¬ ì¶”êµ¬</li><li>ë‚´ë©´ ì¤‘ì‹œ</li></ul>',
            '<h3 class="font-bold text-lg mb-3">âœ¡ï¸ ìœ ëŒ€êµ</h3><p>í•˜ë‚˜ë‹˜ì€ <strong>ì—­ì‚¬ ì†ì—ì„œ í–‰ë™í•˜ì‹œëŠ” ë¶„</strong>ì…ë‹ˆë‹¤.</p><ul class="list-disc list-inside text-sm mt-3"><li>ì‹œë‚´ì‚°, ì¶œì• êµ½</li><li>ì˜ˆì–¸ìë“¤ì˜ ì„ í¬</li><li>í† ë¼ì˜ ê¶Œìœ„</li></ul>',
            '<h3 class="font-bold text-lg mb-3">âš”ï¸ ì´ë ˆë„¤ìš°ìŠ¤</h3><p>ì˜ì§€ì£¼ì˜ì˜ ë¹„ë°€ ê³„ì‹œì— ë§ì„œ <strong>ê³µì  ì‚¬ë„ ì „ìŠ¹</strong>ì„ ê°•ì¡°í–ˆìŠµë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-lg mb-3">ğŸ’¡ ì•„ìš°êµ¬ìŠ¤í‹°ëˆ„ìŠ¤</h3><p><strong>ë‚´ë©´ì˜ ë¹›(lumen interius)</strong>ì„ í†µí•œ ê³„ì‹œë¥¼ ê°•ì¡°í–ˆìŠµë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-lg mb-3">âš–ï¸ ì•„í€´ë‚˜ìŠ¤</h3><p><strong>ìì—°ê³¼ ì€ì´ì˜ ì¡°í™”</strong>ë¥¼ ì²´ê³„í™”í–ˆìŠµë‹ˆë‹¤.</p><ul class="list-disc list-inside text-sm mt-3"><li>ìì—° ê³„ì‹œ: ì´ì„±ìœ¼ë¡œ í•˜ë‚˜ë‹˜ ì¡´ì¬ ì¦ëª…</li><li>íŠ¹ë³„ ê³„ì‹œ: ì‚¼ìœ„ì¼ì²´ ë“±</li></ul>',
            '<h3 class="font-bold text-lg mb-3">ğŸ“œ ë£¨í„°</h3><p><strong>Sola Scriptura!</strong> ì˜¤ì§ ì„±ê²½ë§Œì´ ê³„ì‹œì˜ ê·œë²”ì…ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-lg mb-3">ğŸ•Šï¸ ì¹¼ë±…</h3><p><strong>ì„±ë ¹ì˜ ë‚´ì  ì¦ê±°</strong>ê°€ ì„±ê²½ì˜ ê¶Œìœ„ë¥¼ í™•ì¦í•©ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-lg mb-3">ğŸ’­ ìŠë¼ì´ì–´ë§ˆí—ˆ</h3><p>ê³„ì‹œë¥¼ <strong>ì ˆëŒ€ ì˜ì¡´ì˜ ê°ì •</strong>ìœ¼ë¡œ ì¬í•´ì„í–ˆìŠµë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-lg mb-3">ğŸ”¥ ë°”ë¥´íŠ¸</h3><p>ìì—° ê³„ì‹œì— <strong>"Nein!"</strong>ì„ ì„ ì–¸í•©ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-lg mb-3">ğŸ­ ë¶ˆíŠ¸ë§Œ</h3><p>ê³„ì‹œë¥¼ <strong>ì¼€ë¦¬ê·¸ë§ˆì™€ì˜ ì‹¤ì¡´ì  ë§Œë‚¨</strong>ìœ¼ë¡œ í•´ì„í•©ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-lg mb-3">ğŸŒ ë³¸íšŒí¼</h3><p><strong>ë¹„ì¢…êµì  í•´ì„</strong>ì„ íƒêµ¬í•©ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-lg mb-3">ğŸ“š íŒë„¨ë² ë¥´í¬</h3><p><strong>ì—­ì‚¬ë¡œì„œì˜ ê³„ì‹œ</strong>ë¥¼ ì£¼ì¥í•©ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-lg mb-3">ğŸ“Š ìµœì¢… ì „í™© ë³´ê³ </h3><div class="space-y-2 text-sm"><p>ğŸ”µ <strong>ê°ê´€ì£¼ì˜:</strong> ìœ ëŒ€êµ, íŒë„¨ë² ë¥´í¬</p><p>ğŸ”´ <strong>ì£¼ê´€ì£¼ì˜:</strong> ë¶ˆíŠ¸ë§Œ, ìŠë¼ì´ì–´ë§ˆí—ˆ</p><p>ğŸŸ¢ <strong>ê· í˜•íŒŒ:</strong> ë°”ë¥´íŠ¸, ì¹¼ë±…</p><p>ğŸŸ¡ <strong>ìì—°ì‹ í•™:</strong> ì•„í€´ë‚˜ìŠ¤, í—¬ë¼</p></div><p class="mt-4 font-medium">ğŸ‘‰ ë‹¹ì‹ ì€ ì–´ëŠ ì¢Œí‘œì—?</p>'
        ];

        const steps = [
            { title: "3ëŒ€ ì „ì„ ", badge: "Overview", layers: [], desc: 0 },
            { title: "í—¬ë¼ ì² í•™", badge: "Hellenism", layers: ['hellenism'], desc: 1 },
            { title: "ìœ ëŒ€êµ", badge: "Judaism", layers: ['hellenism', 'judaism'], desc: 2 },
            { title: "ì´ë ˆë„¤ìš°ìŠ¤", badge: "Irenaeus", layers: ['hellenism', 'judaism', 'irenaeus'], desc: 3 },
            { title: "ì•„ìš°êµ¬ìŠ¤í‹°ëˆ„ìŠ¤", badge: "Augustine", layers: ['hellenism', 'judaism', 'irenaeus', 'augustine'], desc: 4 },
            { title: "ì•„í€´ë‚˜ìŠ¤", badge: "Aquinas", layers: ['hellenism', 'judaism', 'irenaeus', 'augustine', 'aquinas'], desc: 5 },
            { title: "ë£¨í„°", badge: "Luther", layers: ['hellenism', 'judaism', 'luther'], desc: 6 },
            { title: "ì¹¼ë±…", badge: "Calvin", layers: ['hellenism', 'judaism', 'luther', 'calvin'], desc: 7 },
            { title: "ìŠë¼ì´ì–´ë§ˆí—ˆ", badge: "Schleiermacher", layers: ['hellenism', 'judaism', 'schleiermacher'], desc: 8 },
            { title: "ë°”ë¥´íŠ¸", badge: "Barth", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth'], desc: 9 },
            { title: "ë¶ˆíŠ¸ë§Œ", badge: "Bultmann", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann'], desc: 10 },
            { title: "ë³¸íšŒí¼", badge: "Bonhoeffer", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann', 'bonhoeffer'], desc: 11 },
            { title: "íŒë„¨ë² ë¥´í¬", badge: "Pannenberg", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann', 'bonhoeffer', 'pannenberg'], desc: 12 },
            { title: "ìµœì¢… ë³´ê³ ", badge: "Summary", layers: Object.keys(allLayers), desc: 13 }
        ];

        let currentStep = 0;
        let currentMode = 'story';
        let chartInstance = null;
        const customSelection = new Set();

        function init() {
            initChart();
            buildProgressBar();
            buildLayerPanel();
            updateView();
        }

        function initChart() {
            chartInstance = new Chart(document.getElementById('theologyChart').getContext('2d'), {
                type: 'radar',
                data: { labels: labels, datasets: [] },
                options: {
                    responsive: true, maintainAspectRatio: true,
                    scales: { r: { min: 0, max: 5, ticks: { display: false }, pointLabels: { font: { family: "'Noto Sans KR'", size: 10, weight: '600' }, color: '#475569' }, grid: { color: 'rgba(148,163,184,0.3)', circular: true } } },
                    plugins: { legend: { display: false } },
                    animation: { duration: 400 }
                }
            });
        }

        function buildProgressBar() {
            const bar = document.getElementById('progress-bar');
            bar.innerHTML = steps.map((s, i) => '<button onclick="goToStep(' + i + ')" class="step-pill px-2 py-1 rounded-full text-[10px] font-semibold whitespace-nowrap ' + (i === 0 ? 'active' : '') + '">' + s.badge + '</button>').join('');
        }

        function buildLayerPanel() {
            const groups = { root: 'layer-roots', medieval: 'layer-medieval', reformation: 'layer-reformation', modern: 'layer-modern' };
            Object.values(allLayers).forEach(function (l) {
                const container = document.getElementById(groups[l.type]);
                const el = document.createElement('div');
                el.id = 'layer-' + l.id;
                el.className = 'layer-item flex items-center gap-2 px-2 py-1.5 rounded-lg cursor-pointer inactive';
                el.innerHTML = '<span class="w-2.5 h-2.5 rounded-full shrink-0" style="background:' + l.borderColor + '"></span><span class="text-xs font-medium text-slate-700">' + l.label + '</span>';
                el.onclick = function () { if (currentMode === 'custom') toggleLayer(l.id); };
                container.appendChild(el);
            });
        }

        function updateLayerPanel(activeIds) {
            Object.keys(allLayers).forEach(function (id) {
                const el = document.getElementById('layer-' + id);
                if (activeIds.includes(id)) {
                    el.classList.remove('inactive');
                    el.classList.add('selected');
                } else {
                    el.classList.add('inactive');
                    el.classList.remove('selected');
                }
            });
        }

        function toggleLayer(id) {
            if (customSelection.has(id)) customSelection.delete(id);
            else customSelection.add(id);
            updateCustomView();
        }

        function updateCustomView() {
            const ids = Array.from(customSelection);
            chartInstance.data.datasets = ids.map(function (id) { return getDataset(id); });
            chartInstance.update();
            updateLayerPanel(ids);
            document.getElementById('insight-text').innerHTML = generateInsight(ids);
            document.getElementById('insight-badge').textContent = ids.length + 'ê°œ ì„ íƒ';
            // ë¹„êµ ëª¨ë“œì—ì„œë„ ì„ íƒëœ ì²« ë²ˆì§¸ ë ˆì´ì–´ì˜ ì„¤ëª… í‘œì‹œ
            if (ids.length > 0) {
                const firstId = ids[ids.length - 1]; // ë§ˆì§€ë§‰ ì„ íƒëœ ê²ƒ
                const idx = Object.keys(allLayers).indexOf(firstId) + 1;
                if (idx > 0 && idx < stepDescriptions.length) {
                    document.getElementById('detail-badge').textContent = allLayers[firstId].label;
                    document.getElementById('detail-title').textContent = '';
                    document.getElementById('detail-desc').innerHTML = stepDescriptions[idx];
                }
            } else {
                document.getElementById('detail-badge').textContent = 'ë¹„êµ ëª¨ë“œ';
                document.getElementById('detail-title').textContent = '';
                document.getElementById('detail-desc').innerHTML = '<p class="text-slate-400">ì¢Œì¸¡ì—ì„œ ë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>';
            }
        }

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('btn-mode-story').className = mode === 'story' ? 'px-4 py-2 text-sm font-bold rounded-full bg-indigo-600 text-white shadow-md' : 'px-4 py-2 text-sm font-bold rounded-full bg-slate-200 text-slate-600 hover:bg-slate-300';
            document.getElementById('btn-mode-custom').className = mode === 'custom' ? 'px-4 py-2 text-sm font-bold rounded-full bg-indigo-600 text-white shadow-md' : 'px-4 py-2 text-sm font-bold rounded-full bg-slate-200 text-slate-600 hover:bg-slate-300';
            document.getElementById('story-nav').style.display = mode === 'story' ? 'flex' : 'none';
            document.getElementById('progress-bar').style.display = mode === 'story' ? 'flex' : 'none';
            document.getElementById('layer-mode-hint').textContent = mode === 'story' ? 'ìŠ¤í† ë¦¬ ëª¨ë“œ: ìë™ ì§„í–‰' : 'ë¹„êµ ëª¨ë“œ: í´ë¦­í•˜ì—¬ ì„ íƒ';
            if (mode === 'story') {
                customSelection.clear();
                updateView();
            } else {
                updateCustomView();
            }
        }

        function updateView() {
            const step = steps[currentStep];
            chartInstance.data.datasets = step.layers.map(function (id) { return getDataset(id); });
            chartInstance.update();
            updateLayerPanel(step.layers);
            document.getElementById('insight-text').innerHTML = storyInsights[currentStep];
            document.getElementById('insight-badge').textContent = 'Step ' + (currentStep + 1) + '/' + steps.length;
            document.getElementById('detail-badge').textContent = step.badge;
            document.getElementById('detail-title').textContent = step.title;
            document.getElementById('detail-desc').innerHTML = stepDescriptions[step.desc];
            document.querySelectorAll('.step-pill').forEach(function (el, i) { el.classList.toggle('active', i === currentStep); });
            document.getElementById('btn-prev').disabled = currentStep === 0;
            document.getElementById('btn-next').disabled = currentStep === steps.length - 1;
        }

        function goToStep(i) { currentStep = i; updateView(); }
        function nextStep() { if (currentStep < steps.length - 1) { currentStep++; updateView(); } }
        function prevStep() { if (currentStep > 0) { currentStep--; updateView(); } }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>