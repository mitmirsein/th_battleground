<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="에덴 동산지기">
    <meta name="theme-color" content="#2d4a3e">
    <meta name="description" content="365일 말씀과 기도로 에덴 동산을 가꾸는 영적 여정">

    <title>에덴 동산지기 | Eden Gardener</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16.png">

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css?v=1.3">
    <link rel="stylesheet" href="css/animations.css?v=1.3">
    <link rel="stylesheet" href="css/pebbles.css?v=1.3">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <div id="app">
        <!-- Screen 1: Intro -->
        <section id="screen-intro" class="screen active">
            <div class="screen-content">
                <div class="scroll-icon">📜</div>
                <h1>에덴의 미완성 이야기</h1>
                <div class="story-text">
                    <p>"태초에 하나님이 동산을 만드시고<br>사람에게 맡기셨습니다.</p>
                    <p>하지만 첫 동산지기는<br>동산을 끝까지 지키지 못했습니다.</p>
                    <p class="highlight">당신은 다를 수 있습니다."</p>
                </div>
                <button class="btn-primary" onclick="goToScreen('screen-avatar')">
                    이야기 시작하기
                </button>

                <!-- Footer -->
                <footer class="site-footer">
                    <p><a href="install.html"><i data-lucide="smartphone"
                                style="width:1em;height:1em;vertical-align:-0.125em;"></i>
                            앱 설치</a> | powered by <a href="https://kerygma.co.kr" target="_blank"
                            rel="noopener"><strong>케리그마출판사</strong></a></p>
                </footer>
            </div>
        </section>

        <!-- Screen 2: Avatar Selection -->
        <section id="screen-avatar" class="screen">
            <div class="screen-content">
                <h2>👤 당신은 누구입니까?</h2>
                <div class="avatar-selection">
                    <div class="avatar-card" onclick="selectAvatar('adam')">
                        <div class="avatar-icon">🧔</div>
                        <div class="avatar-name">아담</div>
                        <div class="avatar-subtitle">(Adam)</div>
                        <div class="avatar-desc">"흙의 아들"</div>
                    </div>
                    <div class="avatar-card" onclick="selectAvatar('eve')">
                        <div class="avatar-icon">👩</div>
                        <div class="avatar-name">이브</div>
                        <div class="avatar-subtitle">(Eve)</div>
                        <div class="avatar-desc">"생명의 딸"</div>
                    </div>
                </div>
                <button class="btn-primary btn-disabled" id="btn-avatar-next" onclick="completeAvatarSelection()">
                    다음
                </button>
            </div>
        </section>

        <!-- Screen 3: Leather Garment Ceremony -->
        <section id="screen-garment" class="screen">
            <div class="screen-content">
                <h2>🧥 동산지기의 옷</h2>
                <div class="garment-box">
                    <img src="assets/garment/apron.svg" alt="가죽 앞치마" class="garment-display-svg">
                    <div class="garment-label">가죽 앞치마</div>
                    <div class="garment-quote">
                        "첫 아담에게<br>입혀주셨던<br>그 옷입니다"
                    </div>
                </div>
                <p class="scripture-ref">
                    "여호와 하나님이 아담과 그의 아내를 위하여<br>
                    <strong>가죽옷</strong>을 지어 입히시니라"<br>
                    <span class="ref">— 창세기 3:21</span>
                </p>
                <p class="instruction">하나님이 첫 동산지기에게 입혀주셨던 옷을<br>이제 당신이 입습니다.</p>
                <button class="btn-primary" onclick="goToScreen('screen-pledge')">
                    입기
                </button>
            </div>
        </section>

        <!-- Screen 4: Pledge -->
        <section id="screen-pledge" class="screen">
            <div class="screen-content">
                <h2>✋ 동산지기의 서약</h2>
                <div class="avatar-dressed">
                    <span id="pledge-avatar-icon">👤</span>
                    <img src="assets/garment/apron.svg" alt="앞치마" class="garment-svg">
                </div>
                <div class="pledge-text">
                    <p>"나 <span id="pledge-name" class="name-highlight"></span><span id="pledge-josa"></span></p>
                    <p>오늘부터 <strong>365일</strong>,</p>
                    <p>이 동산을 <strong>경작하며</strong></p>
                    <p><strong>지키기로</strong> 다짐합니다.</p>
                    <p class="pledge-final">첫 동산지기가 실패했던 그 여정을,<br><strong>나는 끝까지 완주하겠습니다.</strong></p>
                </div>
                <button class="btn-primary btn-pledge" onclick="confirmPledge()">
                    서약합니다
                </button>
            </div>
        </section>

        <!-- Screen 5: Planting Seed -->
        <section id="screen-seed" class="screen">
            <div class="screen-content">
                <h2>🌱 첫 번째 씨앗</h2>
                <div class="planting-scene">
                    <div class="watering-animation">
                        <img src="assets/icons/watering-can.svg" alt="물조리개" class="watering-can-img">
                        <div class="water-drops">
                            <span class="drop">💧</span>
                            <span class="drop">💧</span>
                            <span class="drop">💧</span>
                        </div>
                    </div>
                    <div class="seed-box">
                        <div class="seed-icon">🌰</div>
                        <div class="seed-label">겨자씨</div>
                    </div>
                </div>
                <div class="scripture-box">
                    <p>"천국은 마치 <strong>겨자씨</strong> 한 알 같으니<br>
                        사람이 가져다가 자기 밭에 심은 것이라<br>
                        이것은 모든 씨보다 작은 것이로되<br>
                        자라면 풀보다 커서 나무가 되매..."</p>
                    <span class="ref">— 마태복음 13:31-32</span>
                </div>
                <p class="seed-instruction">작은 씨앗 하나로 시작합니다.<br>365일 후, 이 동산은 <strong>에덴</strong>이 됩니다.</p>
                <button class="btn-primary btn-water" onclick="plantSeed()">
                    🌱 겨자씨 심기
                </button>
            </div>
        </section>

        <!-- Screen 6: Completion -->
        <section id="screen-complete" class="screen">
            <div class="screen-content">
                <h2>✨ Day 1 완료</h2>
                <div class="completion-scene">
                    <div class="watering-animation">
                        <img src="assets/icons/watering-can.svg" alt="물조리개" class="watering-can-img">
                        <div class="water-drops">
                            <span class="drop">💧</span>
                            <span class="drop">💧</span>
                            <span class="drop">💧</span>
                        </div>
                    </div>
                    <div class="planted-seed">
                        <div class="seed-icon grown">🌱</div>
                        <div class="seed-status">(심김)</div>
                    </div>
                </div>
                <div class="completion-message">
                    <p class="success">겨자씨가 심겨졌습니다.</p>
                    <p>내일 다시 와서 물과 먹이를 주세요.</p>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0.3%"></div>
                </div>
                <div class="progress-text">
                    <span>Day 1 / 365</span>
                    <span>0.3%</span>
                </div>
                <button class="btn-primary" onclick="goToScreen('screen-daily')">
                    오늘의 묵상 시작
                </button>
            </div>
        </section>

        <!-- Screen 7: Daily Loop -->
        <section id="screen-daily" class="screen">
            <div class="screen-content daily-view">
                <div class="daily-header">
                    <h2>📖 오늘의 말씀</h2>
                    <div class="day-counter" id="daily-day-counter">Day 1 / 365</div>
                </div>

                <!-- Scripture Section -->
                <div class="scripture-section">
                    <div class="scripture-tabs">
                        <button class="tab-btn active" onclick="switchTab('ot')">구약</button>
                        <button class="tab-btn" onclick="switchTab('nt')">신약</button>
                    </div>

                    <div id="scripture-content" class="scripture-content">
                        <div class="scripture-ref-badge" id="scripture-ref">창세기 2:15</div>
                        <p class="scripture-korean" id="scripture-korean">
                            여호와 하나님이 그 사람을 이끌어 에덴 동산에 두어 그것을 경작하며 지키게 하시고
                        </p>
                    </div>
                </div>

                <!-- Meditation Section (NEW) -->
                <div class="meditation-section">
                    <h3>💭 오늘의 묵상</h3>
                    <div class="meditation-question" id="meditation-question">
                        오늘 하나님의 동산에서 내가 경작하고 지켜야 할 것은 무엇입니까?
                    </div>
                </div>

                <!-- Prayer Section -->
                <div class="prayer-section">
                    <h3>🙏 오늘의 기도</h3>
                    <textarea id="prayer-input" class="prayer-input" placeholder="오늘 묵상을 바탕으로 짧은 기도를 적어보세요..."
                        maxlength="100"></textarea>
                    <div class="prayer-counter">
                        <span id="prayer-char-count">0</span> / 100자
                    </div>
                </div>

                <!-- Care Actions (Water/Feed after meditation) -->
                <div class="care-actions">
                    <h3>🌿 오늘의 돌봄</h3>
                    <div class="care-cards-row" id="today-creature-container">
                        <!-- Dynamically populated by updateCareUI() -->
                    </div>
                </div>

                <!-- Complete Button -->
                <button class="btn-primary btn-complete-day" id="btn-complete-day" onclick="completeDailyLoop()">
                    ✓ 오늘의 묵상 완료
                </button>

                <!-- Footer -->
                <footer class="site-footer">
                    <p><a href="install.html"><i data-lucide="smartphone"
                                style="width:1em;height:1em;vertical-align:-0.125em;"></i>
                            앱 설치</a> | powered by <a href="https://kerygma.co.kr" target="_blank"
                            rel="noopener"><strong>케리그마출판사</strong></a></p>
                </footer>
            </div>
        </section>

        <!-- Screen 8: Garden View -->
        <section id="screen-garden" class="screen">
            <div class="screen-content garden-view">
                <div class="garden-header">
                    <h2>🌳 나의 에덴 동산</h2>
                    <div class="day-counter" id="garden-day-counter">Day 1 / 365</div>
                </div>
                <div class="garden-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="garden-progress-fill" style="width: 0.3%"></div>
                    </div>
                    <div class="progress-stats">
                        <span id="garden-progress-percent">진행률: 0.3%</span>
                    </div>
                </div>
                <div class="garden-actions-pebbles">
                    <button class="pebble-btn" onclick="goToScreen('screen-daily')">
                        <span class="pebble-icon">📖</span>
                        <span class="pebble-label">오늘 말씀</span>
                    </button>
                </div>

                <!-- Footer -->
                <footer class="site-footer">
                    <p><a href="install.html">🌿 앱 설치</a> | powered by <a href="https://kerygma.co.kr" target="_blank"
                            rel="noopener"><strong>케리그마출판사</strong></a></p>
                </footer>
            </div>
        </section>

        <!-- Prayer Log Modal -->
        <div id="prayer-log-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>📜 나의 기도 일지</h3>
                    <button class="modal-close" onclick="closePrayerLog()">&times;</button>
                </div>
                <div class="month-nav">
                    <button class="month-nav-btn" onclick="navigatePrayerMonth(-1)">◀</button>
                    <span id="prayer-month-label">2026년 1월</span>
                    <button class="month-nav-btn" onclick="navigatePrayerMonth(1)">▶</button>
                </div>
                <div class="modal-body" id="prayer-log-list">
                    <!-- Prayer entries will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- iOS Install Prompt -->
    <div id="ios-install-prompt" class="install-prompt hidden">
        <div class="install-prompt-content">
            <button class="install-close" onclick="dismissInstallPrompt()">&times;</button>
            <p>📲 홈 화면에 추가하세요!</p>
            <p class="install-steps">
                <span class="step">1. 하단 공유 버튼 탭</span>
                <span class="step">2. "홈 화면에 추가" 선택</span>
            </p>
        </div>
    </div>

    <script src="js/db.js?v=2.0"></script>
    <script src="js/data.js?v=2.0"></script>
    <script src="js/creatures.js?v=2.0"></script>
    <script src="js/app.js?v=2.0"></script>

    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('✅ Service Worker registered:', registration.scope);
                } catch (error) {
                    console.warn('⚠️ Service Worker registration failed:', error);
                }
            });
        }

        // iOS Install Prompt
        function showInstallPrompt() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            const dismissed = localStorage.getItem('installPromptDismissed');

            if (isIOS && !isStandalone && !dismissed) {
                setTimeout(() => {
                    document.getElementById('ios-install-prompt').classList.remove('hidden');
                }, 3000);
            }
        }

        function dismissInstallPrompt() {
            document.getElementById('ios-install-prompt').classList.add('hidden');
            localStorage.setItem('installPromptDismissed', 'true');
        }

        // Show prompt after first visit
        if (document.readyState === 'complete') {
            showInstallPrompt();
        } else {
            window.addEventListener('load', showInstallPrompt);
        }
    </script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>