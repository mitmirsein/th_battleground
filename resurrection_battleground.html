<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€í™œ ë…¼ìŸì˜ 3ëŒ€ ì „ì„ : ì‹ í•™ ìƒí™©ì‹¤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;600;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .slide-in-right {
            animation: slideInRight 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .step-marker.active {
            background-color: #4f46e5;
            border-color: #4f46e5;
            color: white;
            transform: scale(1.1);
        }

        .step-marker.visited {
            background-color: #e0e7ff;
            border-color: #4f46e5;
            color: #4f46e5;
        }

        .toggle-checkbox:checked {
            right: 0;
            border-color: #68D391;
        }

        .toggle-checkbox:checked+.toggle-label {
            background-color: #68D391;
        }
    </style>
</head>

<body
    class="min-h-screen flex flex-col bg-slate-50 text-slate-800 overflow-x-hidden selection:bg-indigo-100 selection:text-indigo-900">

    <!-- Top Bar -->
    <header
        class="h-14 lg:h-auto bg-white border-b border-slate-200 shadow-sm z-10 px-4 lg:px-8 py-2 lg:py-4 flex flex-col md:flex-row justify-between items-center shrink-0">
        <div class="flex items-center gap-2 lg:gap-3 mb-2 md:mb-0">
            <span class="text-2xl lg:text-3xl">âš”ï¸</span>
            <div>
                <h1 class="text-base lg:text-xl font-extrabold text-slate-900 tracking-tight leading-tight">ë¶€í™œ ë…¼ìŸì˜ 3ëŒ€ ì „ì„ 
                </h1>
                <p class="text-[10px] text-slate-500 font-medium tracking-wide uppercase hidden sm:block">Theological
                    Warfare Map</p>
            </div>
        </div>
        <div id="timeline-wrapper" class="hidden lg:flex items-center gap-1 transition-opacity duration-300">
            <div id="timeline-container" class="flex gap-2"></div>
        </div>
    </header>

    <!-- ëª¨ë°”ì¼ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="lg:hidden flex border-b border-slate-200 bg-white">
        <button onclick="showMobileTab('chart')" id="tab-chart"
            class="flex-1 py-2 text-xs font-bold text-center border-b-2 border-indigo-500 text-indigo-600">ì°¨íŠ¸</button>
        <button onclick="showMobileTab('right')" id="tab-right"
            class="flex-1 py-2 text-xs font-bold text-center border-b-2 border-transparent text-slate-400">ìŠ¤í† ë¦¬</button>
    </div>

    <!-- Main Workspace -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden relative">

        <!-- Left Panel: Chart -->
        <section id="panel-chart"
            class="flex-1 bg-slate-100/50 flex items-center justify-center p-4 lg:p-8 relative min-h-[50vh] lg:min-h-0">
            <div
                class="bg-white rounded-2xl lg:rounded-3xl shadow-xl border border-slate-100 p-2 w-full max-w-sm lg:max-w-[75vh] aspect-square relative transition-all duration-500 hover:shadow-2xl">
                <div
                    class="absolute inset-0 rounded-2xl lg:rounded-3xl bg-gradient-to-br from-indigo-50/50 to-pink-50/50 pointer-events-none">
                </div>
                <canvas id="theologyChart" class="relative z-10"></canvas>
            </div>
            <div
                class="absolute bottom-4 left-4 lg:bottom-6 lg:left-8 hidden lg:block space-y-2 text-[10px] lg:text-xs font-semibold text-slate-400 bg-white/80 backdrop-blur px-3 lg:px-4 py-2 lg:py-3 rounded-lg border border-slate-200 shadow-sm">
                <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-blue-500"></span> ê°ê´€ (Fact)
                </div>
                <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-pink-500"></span> ì£¼ê´€ (Meaning)
                </div>
                <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-teal-500"></span> ì‹¤ì²œ (Action)
                </div>
            </div>
        </section>

        <!-- Right Panel -->
        <section id="panel-right"
            class="hidden lg:flex w-full lg:w-[480px] xl:w-[550px] bg-white border-l border-slate-200 flex-col shadow-[0_0_40px_-10px_rgba(0,0,0,0.1)] z-20 max-h-[50vh] lg:max-h-full">

            <!-- Tabs -->
            <div class="flex border-b border-slate-200 shrink-0">
                <button onclick="switchMode('story')" id="mode-tab-story"
                    class="flex-1 py-3 lg:py-4 text-xs lg:text-sm font-bold uppercase tracking-wide border-b-2 border-indigo-600 text-indigo-600 bg-indigo-50/50 transition-colors">
                    ğŸ“– ìŠ¤í† ë¦¬
                </button>
                <button onclick="switchMode('custom')" id="mode-tab-custom"
                    class="flex-1 py-3 lg:py-4 text-xs lg:text-sm font-bold uppercase tracking-wide border-b-2 border-transparent text-slate-400 hover:text-slate-600 hover:bg-slate-50 transition-colors">
                    ğŸ› ï¸ ì‹¤í—˜ì‹¤
                </button>
            </div>

            <!-- Content Area (Scrollable) -->
            <div class="flex-1 overflow-y-auto custom-scroll relative bg-slate-50/30">

                <!-- STORY MODE -->
                <div id="story-panel" class="flex flex-col min-h-full transition-opacity duration-300">
                    <div class="p-4 lg:p-8 pb-2 lg:pb-4">
                        <div class="flex items-center gap-2 mb-2">
                            <span id="step-badge"
                                class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider bg-indigo-100 text-indigo-700">Intel
                                Report</span>
                            <span id="step-counter" class="text-xs font-mono text-slate-400">01 / 16</span>
                        </div>
                        <h2 id="step-title"
                            class="text-xl lg:text-2xl xl:text-3xl font-bold text-slate-900 leading-tight"></h2>
                        <p id="step-subtitle" class="text-base lg:text-lg text-slate-500 font-medium mt-2"></p>
                    </div>
                    <div class="px-4 lg:px-8 pb-4 lg:pb-8">
                        <div id="step-desc"
                            class="prose prose-slate prose-sm lg:prose-lg max-w-none text-slate-600 leading-relaxed">
                        </div>
                    </div>
                </div>

                <!-- CUSTOM MODE -->
                <div id="custom-panel" class="hidden flex flex-col min-h-full transition-opacity duration-300">
                    <div class="p-4 lg:p-6 pb-2">
                        <h2 class="text-xl lg:text-2xl font-bold text-slate-900">ë ˆì´ì–´ ì‹¤í—˜ì‹¤</h2>
                        <p class="text-slate-500 text-sm mt-1">ì›í•˜ëŠ” ì§€ì¸µê³¼ ì‹ í•™ìë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
                    </div>
                    <div class="p-4 lg:p-6 space-y-4 lg:space-y-6">
                        <div>
                            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-2">ê³ ëŒ€ ë°°ê²½</h3>
                            <div class="space-y-2" id="controls-roots"></div>
                        </div>
                        <div>
                            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-2">êµë¶€ & ì¤‘ì„¸</h3>
                            <div class="space-y-2" id="controls-medieval"></div>
                        </div>
                        <div>
                            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-2">ì¢…êµê°œí˜</h3>
                            <div class="space-y-2" id="controls-reformation"></div>
                        </div>
                        <div>
                            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-2">ê·¼í˜„ëŒ€</h3>
                            <div class="space-y-2" id="controls-moderns"></div>
                        </div>
                    </div>
                    <div class="h-20"></div>
                </div>
            </div>

            <!-- SHARED FOOTER -->
            <div class="border-t border-slate-200 bg-white shrink-0 shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.1)] z-30">

                <!-- Insight Panel -->
                <div id="insight-panel"
                    class="px-4 lg:px-6 py-3 lg:py-5 bg-indigo-50/50 border-b border-indigo-100 transition-all">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <span
                                class="text-[10px] lg:text-xs font-bold uppercase tracking-wider text-indigo-600 bg-white border border-indigo-100 px-2 py-1 rounded shadow-sm">âš¡
                                AI Insight</span>
                        </div>
                        <button onclick="resetCustom()" id="btn-reset"
                            class="hidden text-xs text-slate-400 hover:text-red-500 underline">ì´ˆê¸°í™”</button>
                    </div>
                    <div id="insight-text" class="text-slate-700 text-sm leading-relaxed font-medium"></div>
                </div>

                <!-- Navigation -->
                <div id="nav-controls" class="p-3 lg:p-4 flex gap-2 lg:gap-3">
                    <button onclick="prevStep()" id="btn-prev"
                        class="flex-1 px-3 lg:px-4 py-2 lg:py-3 rounded-lg font-bold text-slate-500 bg-slate-100 hover:bg-slate-200 hover:text-slate-700 transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm">ì´ì „</button>
                    <button onclick="nextStep()" id="btn-next"
                        class="flex-[2] px-3 lg:px-4 py-2 lg:py-3 rounded-lg font-bold text-white bg-indigo-600 hover:bg-indigo-700 shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2 text-sm">ë‹¤ìŒ
                        ë¶„ì„</button>
                </div>
            </div>

        </section>
    </main>

    <script>
        // ëª¨ë°”ì¼ íƒ­ ì „í™˜
        function showMobileTab(tab) {
            const tabs = ['chart', 'right'];
            tabs.forEach(t => {
                const panel = document.getElementById('panel-' + t);
                const tabBtn = document.getElementById('tab-' + t);
                if (t === tab) {
                    panel.classList.remove('hidden');
                    panel.classList.add('flex');
                    tabBtn.classList.add('border-indigo-500', 'text-indigo-600');
                    tabBtn.classList.remove('border-transparent', 'text-slate-400');
                } else {
                    if (window.innerWidth < 1024) {
                        panel.classList.add('hidden');
                        panel.classList.remove('flex');
                    }
                    tabBtn.classList.remove('border-indigo-500', 'text-indigo-600');
                    tabBtn.classList.add('border-transparent', 'text-slate-400');
                }
            });
        }

        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                document.getElementById('panel-chart').classList.remove('hidden');
                document.getElementById('panel-chart').classList.add('flex');
                document.getElementById('panel-right').classList.remove('hidden');
                document.getElementById('panel-right').classList.add('flex');
            } else {
                // ëª¨ë°”ì¼ë¡œ ì „í™˜ ì‹œ: ì°¨íŠ¸ë§Œ ë³´ì´ê³  ìš°ì¸¡ íŒ¨ë„ ìˆ¨ê¹€
                document.getElementById('panel-right').classList.add('hidden');
                document.getElementById('panel-right').classList.remove('flex');
                document.getElementById('panel-chart').classList.remove('hidden');
                document.getElementById('panel-chart').classList.add('flex');
                // íƒ­ ìƒíƒœ ì´ˆê¸°í™”
                document.getElementById('tab-chart').classList.add('border-indigo-500', 'text-indigo-600');
                document.getElementById('tab-chart').classList.remove('border-transparent', 'text-slate-400');
                document.getElementById('tab-right').classList.remove('border-indigo-500', 'text-indigo-600');
                document.getElementById('tab-right').classList.add('border-transparent', 'text-slate-400');
            }
        });
        // --- Data ---
        const labels = [['ì‹ ì²´/ë¬¼ì§ˆì„±', 'Somatic'], ['ì—­ì‚¬ì  ìƒˆë¡œì›€', 'Novum'], ['ë¯¸ë˜ ì„ ì·¨', 'Proleptic'], ['ì •ì¹˜ì  ì „ë³µì„±', 'Political'], ['ì‹¤ì¡´ì  ì „ìœ ', 'Existential'], ['ì¼€ë¦¬ê·¸ë§ˆ', 'Kerygma'], ['ìš°ì£¼ì  ë²”ìœ„', 'Cosmic']];
        const COLOR_JUDAISM = 'rgba(234, 179, 8, 0.9)';

        const allLayers = {
            hellenism: { id: 'hellenism', label: 'ì§€ì¸µ 1 (í—¬ë¼ ì² í•™)', desc: 'ìœ¡ì²´ íƒˆì¶œ, ë‚´ë©´ ë„í”¼', data: [1, 1, 1, 2, 4, 1, 5], backgroundColor: 'rgba(100, 116, 139, 0.15)', borderColor: 'rgba(100, 116, 139, 0.6)', borderWidth: 1, borderDash: [5, 5], type: 'root' },
            judaism: { id: 'judaism', label: 'ì§€ì¸µ 2 (ìœ ëŒ€êµ)', desc: 'ëª¸ì˜ ë¶€í™œ, ì •ì˜ íšŒë³µ', data: [5, 4, 5, 5, 3, 2, 5], backgroundColor: 'rgba(234, 179, 8, 0.1)', borderColor: COLOR_JUDAISM, borderWidth: 1.5, borderDash: [5, 5], type: 'root' },
            irenaeus: { id: 'irenaeus', label: 'ì´ë ˆë„¤ìš°ìŠ¤', desc: 'ì´ê´„ê°±ì‹ ', data: [5, 4, 4, 2, 3, 3, 5], borderColor: '#8B4513', backgroundColor: 'rgba(139, 69, 19, 0.1)', borderWidth: 2, type: 'medieval' },
            origen: { id: 'origen', label: 'ì˜¤ë¦¬ê²', desc: 'ë§Œìœ íšŒë³µ', data: [2, 3, 3, 1, 4, 3, 5], borderColor: '#06b6d4', backgroundColor: 'rgba(6, 182, 212, 0.1)', borderWidth: 2, type: 'medieval' },
            augustine: { id: 'augustine', label: 'ì•„ìš°êµ¬ìŠ¤í‹°ëˆ„ìŠ¤', desc: 'ì‹ êµ­ë¡ ', data: [4.5, 4, 4, 3, 5, 4, 4], borderColor: '#d97706', backgroundColor: 'rgba(217, 119, 6, 0.1)', borderWidth: 2, type: 'medieval' },
            aquinas: { id: 'aquinas', label: 'í† ë§ˆìŠ¤ ì•„í€´ë‚˜ìŠ¤', desc: 'ì€ì´ê³¼ ìì—°', data: [5, 3, 3, 2, 2, 3, 5], borderColor: '#1e3a8a', backgroundColor: 'rgba(30, 58, 138, 0.1)', borderWidth: 2, type: 'medieval' },
            luther: { id: 'luther', label: 'ë§ˆë¥´í‹´ ë£¨í„°', desc: 'ì˜¤ì§ ë¯¿ìŒ', data: [4, 3, 2, 3, 5, 5, 2], borderColor: '#be123c', backgroundColor: 'rgba(190, 18, 60, 0.1)', borderWidth: 2.5, type: 'reformation' },
            calvin: { id: 'calvin', label: 'ì¥ ì¹¼ë±…', desc: 'ì£¼ê¶Œê³¼ ì˜ê´‘', data: [4, 3, 3, 4, 4, 5, 5], borderColor: '#155e75', backgroundColor: 'rgba(21, 94, 117, 0.1)', borderWidth: 2.5, type: 'reformation' },
            schleiermacher: { id: 'schleiermacher', label: 'ìŠë¼ì´ì–´ë§ˆí—ˆ', desc: 'ê°ì • ì˜ì¡´', data: [2, 2, 2, 2, 5, 3, 3], backgroundColor: 'rgba(236, 72, 153, 0.1)', borderColor: 'rgba(236, 72, 153, 0.6)', borderWidth: 1, borderDash: [5, 5], type: 'modern' },
            barth: { id: 'barth', label: 'ì¹¼ ë°”ë¥´íŠ¸', desc: 'ê°ê´€ì  ë§ì”€', data: [4, 5, 3, 4, 2, 5, 3.5], borderColor: '#16a34a', backgroundColor: 'rgba(22, 163, 74, 0.1)', borderWidth: 2.5, type: 'modern' },
            bultmann: { id: 'bultmann', label: 'ë£¨ëŒí”„ ë¶ˆíŠ¸ë§Œ', desc: 'ì‹¤ì¡´ì  ê²°ë‹¨', data: [1, 2, 1, 1, 5, 5, 1], borderColor: '#2563eb', backgroundColor: 'rgba(37, 99, 235, 0.1)', borderWidth: 3.5, type: 'modern' },
            bonhoeffer: { id: 'bonhoeffer', label: 'ë””íŠ¸ë¦¬íˆ ë³¸íšŒí¼', desc: 'ìœ¤ë¦¬ì  ì‹¤ì²œ', data: [4.5, 3, 2, 5, 4, 3, 3], borderColor: '#9333ea', backgroundColor: 'rgba(147, 51, 234, 0.1)', borderWidth: 3.5, borderDash: [4, 4], type: 'modern' },
            moltmann: { id: 'moltmann', label: 'ìœ„ë¥´ê² ëª°íŠ¸ë§Œ', desc: 'í¬ë§ê³¼ ë³€í˜', data: [4.5, 5, 5, 5, 3, 2, 5], borderColor: '#f97316', backgroundColor: 'rgba(249, 115, 22, 0.1)', borderWidth: 3.5, type: 'modern' },
            pannenberg: { id: 'pannenberg', label: 'ë³¼í”„í•˜ë¥´íŠ¸ íŒë„¨ë² ë¥´í¬', desc: 'ì´ì„±ê³¼ ì—­ì‚¬', data: [5, 4, 5, 3, 1, 2, 5], borderColor: '#dc2626', backgroundColor: 'rgba(220, 38, 38, 0.1)', borderWidth: 2.5, borderDash: [10, 5], type: 'modern' }
        };

        function getDataset(key) {
            const raw = allLayers[key];
            return {
                label: raw.label,
                data: raw.data,
                backgroundColor: raw.backgroundColor,
                borderColor: raw.borderColor,
                borderWidth: raw.borderWidth,
                borderDash: raw.borderDash || [],
                pointRadius: raw.type === 'root' ? 0 : 3
            };
        }

        // --- Insight Engine (Super Ultra Think Hard) ---
        const axisMeanings = [
            { name: "ì‹ ì²´/ë¬¼ì§ˆì„±", desc: "ìœ¡ì²´ì™€ ë¬¼ì§ˆ ì„¸ê³„ì˜ êµ¬ì²´ì  íšŒë³µ", group: "ê°ê´€" },
            { name: "ì—­ì‚¬ì  ìƒˆë¡œì›€", desc: "ì—­ì‚¬ë¥¼ ëš«ê³  ë“¤ì–´ì˜¤ëŠ” ì¢…ë§ë¡ ì  ì‚¬ê±´", group: "ê°ê´€" },
            { name: "ë¯¸ë˜ ì„ ì·¨", desc: "ë¯¸ë˜ì˜ í¬ë§ì„ í˜„ì¬ë¡œ ì•ë‹¹ê²¨ ì˜´", group: "ì‹¤ì²œ" },
            { name: "ì •ì¹˜ì  ì „ë³µì„±", desc: "ì‚¬íšŒ êµ¬ì¡°ì™€ ë¶ˆì˜ì— ëŒ€í•œ ì €í•­", group: "ì‹¤ì²œ" },
            { name: "ì‹¤ì¡´ì  ì „ìœ ", desc: "ê°œì¸ì˜ ë‚´ë©´ì  ê²°ë‹¨ê³¼ ì£¼ê´€ì  ë¯¿ìŒ", group: "ì£¼ê´€" },
            { name: "ì¼€ë¦¬ê·¸ë§ˆ", desc: "ì„ í¬ëœ ë§ì”€ì˜ ì–¸ì–´ì  ì‚¬ê±´", group: "ì£¼ê´€" },
            { name: "ìš°ì£¼ì  ë²”ìœ„", desc: "ì¸ê°„ì„ ë„˜ì–´ì„  ìì—°ê³¼ ìš°ì£¼ ì „ì²´ì˜ êµ¬ì›", group: "ê°ê´€" }
        ];

        // 1. Dual Comparison Logic (2 Layers)
        function generateDetailedInsight(ids) {
            if (ids.length !== 2) return null;
            const l1 = allLayers[ids[0]];
            const l2 = allLayers[ids[1]];

            // Calculate differences
            let maxDiff = 0; let maxIndex = -1;
            let secondDiff = 0; let secondIndex = -1;

            for (let i = 0; i < 7; i++) {
                const diff = Math.abs(l1.data[i] - l2.data[i]);
                if (diff > maxDiff) { secondDiff = maxDiff; secondIndex = maxIndex; maxDiff = diff; maxIndex = i; }
                else if (diff > secondDiff) { secondDiff = diff; secondIndex = i; }
            }

            const highLayer = l1.data[maxIndex] > l2.data[maxIndex] ? l1 : l2;
            const lowLayer = l1.data[maxIndex] > l2.data[maxIndex] ? l2 : l1;
            const axis = axisMeanings[maxIndex];

            let html = `<p class="mb-2 text-indigo-900 font-bold">1:1 ì •ë°€ ëŒ€ì¡° ë¶„ì„</p>`;
            html += `<p class="mb-3 text-sm text-slate-700 leading-relaxed">ë‘ ì…ì¥ì´ ê°€ì¥ ê·¹ëª…í•˜ê²Œ ê°ˆë¦¬ëŠ” 'ê²°ì •ì  ì „ì„ 'ì€ <strong>[${axis.name}]</strong>ì…ë‹ˆë‹¤.<br>`;
            html += `<strong>${highLayer.label}</strong>ì€(ëŠ”) ì´ë¥¼ í•µì‹¬ ê°€ì¹˜ë¡œ ê°•ì¡°(${Math.round(highLayer.data[maxIndex])}ì )í•˜ëŠ” ë°˜ë©´, <strong>${lowLayer.label}</strong>ì€(ëŠ”) ìƒëŒ€ì ìœ¼ë¡œ ì†Œí™€íˆ ë‹¤ë£¨ê±°ë‚˜ ë¶€ì •(${Math.round(lowLayer.data[maxIndex])}ì )í•©ë‹ˆë‹¤.</p>`;

            if (secondIndex !== -1 && secondDiff >= 1.5) {
                const h2 = l1.data[secondIndex] > l2.data[secondIndex] ? l1 : l2;
                const ax2 = axisMeanings[secondIndex];
                html += `<p class="text-sm text-slate-600 bg-slate-50 p-2 rounded">â• <strong>ì¶”ê°€ ê´€ì „ í¬ì¸íŠ¸:</strong> <strong>[${ax2.name}]</strong>ì—ì„œë„ ${h2.label}ì˜ ê°•ì¡°ì ì´ ë” ëšœë ·í•©ë‹ˆë‹¤. ì´ ë‘ ì§€í‘œì˜ ì°¨ì´ê°€ ë‘ ì‹ í•™ì˜ ì„±ê²©ì„ ê°€ë¦…ë‹ˆë‹¤.</p>`;
            }
            return html;
        }

        // 2. Multi-Layer Analysis Logic (3+ Layers)
        function generateMultiInsight(ids) {
            const layers = ids.map(id => allLayers[id]);
            const numLayers = layers.length;
            const numAxes = 7;

            const avgs = new Array(numAxes).fill(0);
            const ranges = new Array(numAxes).fill(0);

            for (let i = 0; i < numAxes; i++) {
                let sum = 0;
                let min = 10, max = 0;
                layers.forEach(l => {
                    const val = l.data[i];
                    sum += val;
                    if (val < min) min = val;
                    if (val > max) max = val;
                });
                avgs[i] = sum / numLayers;
                ranges[i] = max - min;
            }

            const maxAvgIndex = avgs.indexOf(Math.max(...avgs));
            const minAvgIndex = avgs.indexOf(Math.min(...avgs));
            const maxRangeIndex = ranges.indexOf(Math.max(...ranges));

            const strongAxis = axisMeanings[maxAvgIndex];
            const weakAxis = axisMeanings[minAvgIndex];
            const conflictAxis = axisMeanings[maxRangeIndex];

            let html = `<p class="mb-3 text-indigo-900 font-bold">ë‹¤ì°¨ì› ì¢…í•© ë¶„ì„ (${numLayers}ê°œ ë ˆì´ì–´)</p>`;

            // 1. Consensus
            html += `<div class="mb-2 p-2 bg-indigo-50 border-l-4 border-indigo-400 rounded-r">
                <strong class="text-indigo-800 text-xs uppercase tracking-wide">Shared Identity (ê³µí†µ ì •ì²´ì„±)</strong>
                <p class="text-sm text-slate-700 mt-1">ì´ ê·¸ë£¹ì€ <strong>[${strongAxis.name}]</strong>ì„ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ì—¬ê¹ë‹ˆë‹¤. "${strongAxis.desc}"ì— ëŒ€í•´ ë†’ì€ í•©ì˜(${avgs[maxAvgIndex].toFixed(1)}ì )ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.</p>
            </div>`;

            // 2. Conflict
            if (ranges[maxRangeIndex] >= 2.0) {
                html += `<div class="mb-2 p-2 bg-red-50 border-l-4 border-red-400 rounded-r">
                    <strong class="text-red-800 text-xs uppercase tracking-wide">Battleground (ìµœëŒ€ ìŸì )</strong>
                    <p class="text-sm text-slate-700 mt-1">ê°€ì¥ ì˜ê²¬ì´ ê°ˆë¦¬ëŠ” ì§€ì ì€ <strong>[${conflictAxis.name}]</strong>ì…ë‹ˆë‹¤. ê·¸ë£¹ ë‚´ì—ì„œ ì´ ê°€ì¹˜ë¥¼ ë‘ê³  ì…ì¥ì´ ì²¨ì˜ˆí•˜ê²Œ ëŒ€ë¦½í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                </div>`;
            } else {
                html += `<div class="mb-2 p-2 bg-green-50 border-l-4 border-green-400 rounded-r">
                    <strong class="text-green-800 text-xs uppercase tracking-wide">High Cohesion (ë†’ì€ ì¼ì¹˜ë„)</strong>
                    <p class="text-sm text-slate-700 mt-1">ì´ ì¡°í•©ì€ ì „ë°˜ì ìœ¼ë¡œ ì‹ í•™ì  ì§€í–¥ì ì´ ë§¤ìš° ìœ ì‚¬í•˜ì—¬ í° ë‚´ë¶€ ê°ˆë“±ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>`;
            }

            // 3. Blindspot
            html += `<div class="p-2 bg-slate-100 border-l-4 border-slate-400 rounded-r">
                <strong class="text-slate-600 text-xs uppercase tracking-wide">Collective Blindspot (ì§‘ë‹¨ì  ì•½ì )</strong>
                <p class="text-sm text-slate-600 mt-1">ìƒëŒ€ì ìœ¼ë¡œ <strong>[${weakAxis.name}]</strong> ë¶€ë¶„ì´ ì·¨ì•½í•©ë‹ˆë‹¤(${avgs[minAvgIndex].toFixed(1)}ì ). "${weakAxis.desc}"ì— ëŒ€í•œ ê´€ì‹¬ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>`;

            return html;
        }

        // Handcrafted Story Insights
        const storyInsights = [
            "ë¶€í™œ ë…¼ìŸì€ ë‹¨ìˆœíˆ 'ë¯¿ëŠëƒ ë§ˆëŠëƒ'ì˜ ë¬¸ì œê°€ ì•„ë‹™ë‹ˆë‹¤. ì‹ í•™ì˜ ì—­ì‚¬ëŠ” <strong>ê°ê´€(ì‚¬ì‹¤), ì£¼ê´€(ì˜ë¯¸), ì‹¤ì²œ(í–‰ë™)</strong>ì´ë¼ëŠ” ì„¸ ê°€ì§€ ì˜í† ë¥¼ ì°¨ì§€í•˜ê¸° ìœ„í•œ ì¹˜ì—´í•œ ìŸíƒˆì „ì´ì—ˆìŠµë‹ˆë‹¤. ì´ ì§€ë„ë¥¼ í†µí•´ ë‹¹ì‹ ì˜ ì‹ í•™ì  ì¢Œí‘œë¥¼ ì°¾ì•„ë³´ì„¸ìš”.",
            "<strong>í—¬ë¼ì  ì´ì›ë¡ ì˜ í•œê³„:</strong> í”Œë¼í†¤ì£¼ì˜ëŠ” ì˜í˜¼ì˜ ë¶ˆë©¸ì„ ìœ„í•´ ìœ¡ì²´ë¥¼ ê°ì˜¥ìœ¼ë¡œ ê²©í•˜ì‹œì¼°ìŠµë‹ˆë‹¤. ì´ëŠ” ë¶€í™œì„ 'ì—­ì‚¬ì  ì‚¬ê±´'ì´ ì•„ë‹Œ 'ì˜ì  í•´ë°©'ìœ¼ë¡œ ì¶•ì†Œì‹œí‚¤ëŠ” ê²°ê³¼ë¥¼ ë‚³ì•˜ìœ¼ë©°, í›—ë‚  ë¶ˆíŠ¸ë§Œì˜ ì‹¤ì¡´ë¡ ì  í•´ì„ì— ì§€ëŒ€í•œ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.",
            "<strong>ìœ ëŒ€ì  ìœ ì‚°ì˜ ë³µì›:</strong> ê¸°ë…êµ ë¶€í™œ ì‹ ì•™ì˜ ë¿Œë¦¬ëŠ” ìœ ëŒ€ ë¬µì‹œ ì‚¬ìƒì…ë‹ˆë‹¤. ì´ëŠ” ì£½ìŒì¡°ì°¨ ì´ê¸°ëŠ” <strong>'ëª¸ì˜ êµ¬ì²´ì„±'</strong>ê³¼ ì–µìš¸í•œ ìë¥¼ ì‹ ì›í•˜ì‹œëŠ” <strong>'í•˜ë‚˜ë‹˜ì˜ ì •ì˜'</strong>ë¥¼ ê°•ì¡°í•©ë‹ˆë‹¤. ëª°íŠ¸ë§Œê³¼ íŒë„¨ë² ë¥´í¬ê°€ íšŒë³µí•˜ë ¤ í–ˆë˜ ê²ƒì´ ë°”ë¡œ ì´ ì§€ì¸µì…ë‹ˆë‹¤.",
            "<strong>ì´ë ˆë„¤ìš°ìŠ¤ì˜ ìŠ¹ë¶€ìˆ˜:</strong> ì˜ì§€ì£¼ì˜ìë“¤ì€ ë¬¼ì§ˆ ì„¸ê³„ë¥¼ ì•…í•˜ê²Œ ë³´ì•˜ì§€ë§Œ, ì´ë ˆë„¤ìš°ìŠ¤ëŠ” 'ì´ê´„ê°±ì‹ (Recapitulation)'ì„ í†µí•´ <strong>ê·¸ë¦¬ìŠ¤ë„ê°€ íƒ€ë½í•œ ìœ¡ì²´ì™€ ë¬¼ì§ˆ ì„¸ê³„ê¹Œì§€ë„ êµ¬ì†í•˜ì…¨ìŒ</strong>ì„ ì„ í¬í•©ë‹ˆë‹¤. ì´ëŠ” í˜„ëŒ€ ìƒíƒœ ì‹ í•™ì˜ ì¤‘ìš”í•œ ë¿Œë¦¬ê°€ ë©ë‹ˆë‹¤.",
            "<strong>ì˜¤ë¦¬ê²ì˜ ì˜ì  ìŠ¹í™”:</strong> ì˜¤ë¦¬ê²ì€ ì„±ê²½ì„ ì•Œë ˆê³ ë¦¬(ì˜ì )ë¡œ í•´ì„í•˜ë©° ë¶€í™œì²´ë¥¼ ì—í…Œë¥´ì™€ ê°™ì€ ì˜ì  ì‹¤ì²´ë¡œ ë³´ì•˜ìŠµë‹ˆë‹¤. ê·¸ì˜ <strong>'ë§Œìœ íšŒë³µì„¤'</strong>ì€ ëª¨ë“  ì¡´ì¬ê°€ ê²°êµ­ êµ¬ì›ì— ì´ë¥¸ë‹¤ëŠ” ë³´í¸ì  í¬ë§ì„ ì œì‹œí–ˆì§€ë§Œ, ì—­ì‚¬ì  êµ¬ì²´ì„±ì€ ì•½í™”ë˜ì—ˆìŠµë‹ˆë‹¤.",
            "<strong>ì•„ìš°êµ¬ìŠ¤í‹°ëˆ„ìŠ¤ì˜ ê±°ëŒ€í•œ ì¢…í•©:</strong> ê·¸ëŠ” ë°”ìš¸ì˜ ì€ì´ë¡ ê³¼ í”Œë¼í†¤ ì² í•™ì„ ìœµí•©í–ˆìŠµë‹ˆë‹¤. ã€ê³ ë°±ë¡ã€ì˜ ë‚´ë©´ì  ì„±ì°°ê³¼ ã€ì‹ êµ­ë¡ ã€ì˜ ê±°ì‹œì  ì—­ì‚¬ê´€ì€ ì´í›„ ì„œêµ¬ ì‹ í•™ì´ <strong>'ê°œì¸ì˜ êµ¬ì›'ê³¼ 'ì—­ì‚¬ì˜ ì¢…ë§'</strong>ì„ ë™ì‹œì— ë‹¤ë£° ìˆ˜ ìˆëŠ” í† ëŒ€ë¥¼ ë§ˆë ¨í–ˆìŠµë‹ˆë‹¤.",
            "<strong>ì•„í€´ë‚˜ìŠ¤ì˜ ì²´ê³„í™”:</strong> ì‹ ì•™ê³¼ ì´ì„±, ì€ì´ê³¼ ìì—°ì€ ëª¨ìˆœë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•„í€´ë‚˜ìŠ¤ëŠ” ì•„ë¦¬ìŠ¤í† í…”ë ˆìŠ¤ ì² í•™ì„ í†µí•´ <strong>'ë¶€í™œì´ ì´ì„±ì ìœ¼ë¡œë„ íƒ€ë‹¹í•œ ì‚¬ê±´'</strong>ì„ì„ ë…¼ì¦í•˜ë ¤ í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” í›—ë‚  íŒë„¨ë² ë¥´í¬ì˜ ì´ì„±ì  ì—­ì‚¬ ì¦ëª…ì— ì˜ê°ì„ ì¤ë‹ˆë‹¤.",
            "<strong>ë£¨í„°ì˜ í˜ëª…, 'ì˜¤ì§ ë¯¿ìŒ':</strong> ë£¨í„°ëŠ” ì¤‘ì„¸ì˜ ì˜ê´‘ìŠ¤ëŸ¬ìš´ êµíšŒ ì²´ì œë¥¼ ê±°ë¶€í•˜ê³ , ì‹­ìê°€ì— ë‹¬ë¦¬ì‹  í•˜ë‚˜ë‹˜ì„ ë§Œë‚˜ëŠ” <strong>'ê°œì¸ì˜ ì‹¤ì¡´ì  ë¯¿ìŒ'</strong>ìœ¼ë¡œ ëŒì•„ê°”ìŠµë‹ˆë‹¤. ê·¸ì˜ ê·¸ë˜í”„ê°€ 'ì‹¤ì¡´(7ì‹œ)'ê³¼ 'ë§ì”€(8ì‹œ)'ìœ¼ë¡œ ì ë¦° ê²ƒì€ í˜„ëŒ€ ì£¼ê´€ì£¼ì˜ ì‹ í•™ì˜ ì„œë§‰ì„ ì•Œë¦½ë‹ˆë‹¤.",
            "<strong>ì¹¼ë±…ì˜ í™•ì¥, 'ìš°ì£¼ì˜ ë¬´ëŒ€':</strong> ì¹¼ë±…ì€ ë£¨í„°ì˜ ë‚´ë©´ì  ì‹ ì•™ì„ <strong>'ìš°ì£¼ì  ì˜ê´‘ì˜ ë¬´ëŒ€'</strong>ë¡œ í™•ì¥í–ˆìŠµë‹ˆë‹¤. í•˜ë‚˜ë‹˜ì€ êµíšŒë¿ ì•„ë‹ˆë¼ ì„¸ìƒ ëª¨ë“  ì˜ì—­(ì •ì¹˜, ì‚¬íšŒ, ìì—°)ì˜ ì£¼ê¶Œìì´ì‹­ë‹ˆë‹¤. ì´ëŠ” í›—ë‚  ë³€í˜ì  ì‹ í•™(ëª°íŠ¸ë§Œ)ì˜ ì¤‘ìš”í•œ ìì›ì´ ë©ë‹ˆë‹¤.",
            "<strong>ìŠë¼ì´ì–´ë§ˆí—ˆì˜ ê°ì • ì‹ í•™:</strong> ê³„ëª½ì£¼ì˜ì˜ ê³µê²© ì†ì—ì„œ ê¸°ë…êµë¥¼ ì§€í‚¤ê¸° ìœ„í•´ ê·¸ëŠ” êµë¦¬ì™€ ê¸°ì (ê°ê´€ì„±)ì„ í¬ê¸°í•˜ê³  <strong>'ì ˆëŒ€ ì˜ì¡´ì˜ ê°ì •'</strong>ì´ë¼ëŠ” ì£¼ê´€ì  ìš”ìƒˆë¡œ í›„í‡´í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” í˜„ëŒ€ ììœ ì£¼ì˜ ì‹ í•™ì˜ ì¶œë°œì ì´ì ë°”ë¥´íŠ¸ê°€ í‰ìƒ ì‹¸ìš´ ëŒ€ìƒì…ë‹ˆë‹¤.",
            "<strong>ë°”ë¥´íŠ¸ì˜ ë°˜ê²©, 'ë§ì”€ì˜ ì‚¬ê±´':</strong> ë°”ë¥´íŠ¸ëŠ” ì¸ê°„ì˜ ì¢…êµì  ê°ì •ì„ ê±°ë¶€í•˜ê³  <strong>'ìœ„ë¡œë¶€í„° ë‚´ë ¤ê½‚íˆëŠ” ë§ì”€'</strong>ì˜ ê°ê´€ì„±ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤. ê·¸ëŠ” ë¶€í™œì„ ì¸ê°„ì´ ì´í•´í•˜ê±°ë‚˜ ì…ì¦í•  ìˆ˜ ìˆëŠ” ì‚¬ê±´ì´ ì•„ë‹ˆë¼, ì˜¤ì§ í•˜ë‚˜ë‹˜ë§Œì´ ì¼ìœ¼í‚¤ì‹œëŠ” ì£¼ê¶Œì  ê¸°ì (ì›ì—­ì‚¬)ìœ¼ë¡œ ì„ í¬í–ˆìŠµë‹ˆë‹¤.",
            "<strong>ë¶ˆíŠ¸ë§Œì˜ ê²°ë‹¨, 'ë¹„ì‹ í™”í™”':</strong> 'ì „ê¸° ìŠ¤ìœ„ì¹˜ë¥¼ ì¼œëŠ” í˜„ëŒ€ì¸ì´ ë¹ˆ ë¬´ë¤ì„ ë¯¿ì„ ìˆ˜ ìˆëŠ”ê°€?' ë¶ˆíŠ¸ë§Œì€ ê³¼ê°í•˜ê²Œ ê»ë°ê¸°(ì‹ í™”)ë¥¼ ë²„ë¦¬ê³  ì•Œë§¹ì´(ì¼€ë¦¬ê·¸ë§ˆ)ë¥¼ ì·¨í–ˆìŠµë‹ˆë‹¤. ê·¸ì—ê²Œ ë¶€í™œì€ <strong>'ì§€ê¸ˆ ì—¬ê¸°ì„œ ì‹­ìê°€ì˜ ì˜ë¯¸ë¥¼ ê¹¨ë‹«ê³  ê²°ë‹¨í•˜ëŠ” ì‚¬ê±´'</strong>ì…ë‹ˆë‹¤.",
            "<strong>ë³¸íšŒí¼ì˜ ì§ˆë¬¸, 'ë¹„ì¢…êµì  ê¸°ë…êµ':</strong> ê·¸ëŠ” íˆí‹€ëŸ¬ ì•”ì‚´ ìŒëª¨ì— ê°€ë‹´í•˜ë©° ì˜¥ì¤‘ì—ì„œ ë¬»ìŠµë‹ˆë‹¤. 'ë¶€í™œì„ ë¯¿ëŠ”ë‹¤ë©´ ì € ì•…ì— ì¹¨ë¬µí•  ìˆ˜ ìˆëŠ”ê°€?' ê·¸ëŠ” ë‚´ì„¸ì˜ ì†Œë§ì´ ì•„ë‹Œ <strong>'ì„±ì¸ëœ ì„¸ê³„ì—ì„œì˜ ìœ¤ë¦¬ì  ì±…ì„'</strong>ì„ í†µí•´ ë¶€í™œì„ ì¦ëª…í•˜ë ¤ í–ˆìŠµë‹ˆë‹¤.",
            "<strong>ëª°íŠ¸ë§Œì˜ í¬ë§, 'ì•½ì†ì˜ ì„±ì·¨':</strong> 'ì ˆë§ì€ ì£„ë‹¤.' ëª°íŠ¸ë§Œì€ ë¶€í™œì„ ì£½ì€ êµë¦¬ê°€ ì•„ë‹ˆë¼ ë¶ˆì˜í•œ ì„¸ìƒì„ ë’¤ì§‘ëŠ” <strong>'ë³€í˜ì˜ ë™ë ¥'</strong>ìœ¼ë¡œ ì‚¼ì•˜ìŠµë‹ˆë‹¤. ê·¸ì˜ ì‹ í•™ì€ ì‹­ìê°€ì˜ ê³ í†µê³¼ ë¶€í™œì˜ í¬ë§ì„ ì—°ê²°í•˜ì—¬ ì •ì¹˜ ì‹ í•™ì˜ ë¬¸ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.",
            "<strong>íŒë„¨ë² ë¥´í¬ì˜ ì¦ëª…, 'ë³´í¸ì‚¬':</strong> 'ì‹ ì•™ì€ ë§¹ëª©ì ì´ì§€ ì•Šë‹¤.' ê·¸ëŠ” ë¶€í™œì´ ë‹¨ì§€ ì‹ ìë“¤ì˜ ì–¸ì–´ê°€ ì•„ë‹ˆë¼, ì¼ë°˜ ì—­ì‚¬í•™ìœ¼ë¡œë„ ê²€ì¦ ê°€ëŠ¥í•œ <strong>'ì‚¬ì‹¤'</strong>ì„ì„ ì…ì¦í•˜ë ¤ í–ˆìŠµë‹ˆë‹¤. ì´ì„±ì˜ ì–¸ì–´ë¡œ ê¸°ë…êµì˜ ê°ê´€ì„±ì„ ë³€í˜¸í•œ í˜„ëŒ€ì˜ í˜¸êµë¡ ìì…ë‹ˆë‹¤.",
            "<strong>ë‹¹ì‹ ì˜ ì‹ í•™ì€ ì–´ë””ì— ìˆìŠµë‹ˆê¹Œ?</strong> ì´ ì§€ë„ëŠ” ì •ë‹µì´ ì•„ë‹™ë‹ˆë‹¤. í•˜ì§€ë§Œ ë³´ì—¬ì¤ë‹ˆë‹¤. ì‹ í•™ì´ ë‚´ë©´(ë¶ˆíŠ¸ë§Œ)ì— ê°‡íˆë©´ ì„¸ìƒê³¼ ë‹¨ì ˆë˜ê³ , ì„¸ìƒ(ëª°íŠ¸ë§Œ)ìœ¼ë¡œë§Œ í–¥í•˜ë©´ ë‚´ë©´ì´ ë©”ë§ˆë¥¼ ìˆ˜ ìˆìŒì„. ì´ ê¸´ì¥ ì†ì—ì„œ ë‹¹ì‹ ë§Œì˜ ê· í˜•ì ì„ ì°¾ìœ¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤."
        ];

        // --- Insight Controller ---
        function generateInsight(selection) {
            const ids = Array.from(selection).sort();
            const count = ids.length;
            const insightText = document.getElementById('insight-text');

            insightText.classList.remove('animate-pulse');
            void insightText.offsetWidth;
            insightText.classList.add('animate-pulse');

            if (count === 0) return "ë¶„ì„í•  ë ˆì´ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.";

            // 1. Single Selection
            if (count === 1) {
                return `<strong>ğŸ‘¤ ${allLayers[ids[0]].label} í”„ë¡œí•„:</strong><br>${allLayers[ids[0]].desc}.<br><br><span class="text-xs text-slate-500">ë‹¤ë¥¸ í•™ìë¥¼ ì¶”ê°€í•˜ë©´ ë¹„êµ ë¶„ì„ì´ ì‹œì‘ë©ë‹ˆë‹¤.</span>`;
            }

            // 2. Dual Comparison
            if (count === 2) {
                return generateDetailedInsight(ids);
            }

            // 3. Multi-Layer Analysis
            return generateMultiInsight(ids);
        }

        // --- Story Steps Configuration ---
        const steps = [
            { title: "ì „ìŸì˜ ì„œë§‰: 3ëŒ€ ì „ì„ ", subtitle: "ì „í™© ë¶„ì„ ê°œìš”", badge: "Overview", layers: [], desc: `<p class="font-medium text-lg text-slate-800">ì‹ í•™ì˜ ì—­ì‚¬ëŠ” ì´ 3ê°€ì§€ ì˜í† ë¥¼ ì°¨ì§€í•˜ê¸° ìœ„í•œ ìŸíƒˆì „ì…ë‹ˆë‹¤.</p> <div class="grid gap-4 mt-6"> <div class="p-4 bg-blue-50 rounded-xl border border-blue-100 shadow-sm"> <strong class="text-blue-900">ì œ1ì „ì„ : ê°ê´€ì„± (Objectivity)</strong> <p class="text-sm text-blue-700 ml-5">"ë¶€í™œì€ ì§„ì§œ ëª¸ê³¼ ì—­ì‚¬ì˜ ì‚¬ê±´ì¸ê°€?"</p> </div> <div class="p-4 bg-pink-50 rounded-xl border border-pink-100 shadow-sm"> <strong class="text-pink-900">ì œ2ì „ì„ : ì£¼ê´€ì„± (Subjectivity)</strong> <p class="text-sm text-pink-700 ml-5">"ë¶€í™œì€ ë‚˜ì—ê²Œ ì–´ë–¤ ì˜ë¯¸ì¸ê°€?"</p> </div> <div class="p-4 bg-teal-50 rounded-xl border border-teal-100 shadow-sm"> <strong class="text-teal-900">ì œ3ì „ì„ : ì‹¤ì²œì„± (Practice)</strong> <p class="text-sm text-teal-700 ml-5">"ì„¸ìƒì„ ë’¤ì§‘ì„ í˜ì´ ìˆëŠ”ê°€?"</p> </div> </div>` },
            { title: "í—¬ë¼: ë‚´ë©´ìœ¼ë¡œì˜ í›„í‡´", subtitle: "ì§€ì¸µ 1 (í—¬ë¼ ì² í•™)", badge: "Hellenism", layers: ['hellenism'], desc: `<div class="bg-slate-100 p-4 rounded-lg mb-4 text-sm"><strong>í—¬ë¼ì  ì„¸ê³„ê´€:</strong> ìœ¡ì²´ëŠ” ê°ì˜¥ì´ë‹¤. ë‚´ë©´ìœ¼ë¡œ ë„í”¼í•˜ë¼.</div><p>ì œ1ì „ì„ (ê°ê´€)ì„ í¬ê¸°í•˜ê³  ì œ2ì „ì„ (ì£¼ê´€)ì— ìš”ìƒˆë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>` },
            { title: "ìœ ëŒ€êµ: ë°˜ê²©ì˜ ì‹œì‘", subtitle: "ì§€ì¸µ 2 (ìœ ëŒ€êµ)", badge: "Judaism", layers: ['hellenism', 'judaism'], desc: `<div class="bg-yellow-50 p-4 rounded-lg mb-4 text-sm text-yellow-900"><strong>ìœ ëŒ€ ë¬µì‹œ ì‚¬ìƒ:</strong> ëª¸ê³¼ ì •ì˜ë¥¼ íšŒë³µí•˜ë¼.</div><p>í—¬ë¼ê°€ ë²„ë¦° ì œ1ì „ì„ (ì‹ ì²´)ê³¼ ì œ3ì „ì„ (ì •ì¹˜)ì„ ê°•ë ¥í•˜ê²Œ ì‚¬ìˆ˜í•©ë‹ˆë‹¤.</p>` },
            { title: "ì´ë ˆë„¤ìš°ìŠ¤: ì´ê´„ê°±ì‹ ", subtitle: "êµë¶€ ì‹ í•™ 1", badge: "Irenaeus", layers: ['hellenism', 'judaism', 'irenaeus'], desc: `<p><strong>ì˜ì§€ì£¼ì˜ì™€ì˜ ëŒ€ê²°:</strong></p><p>ìœ¡ì²´ë¥¼ ë¶€ì •í•˜ëŠ” ì˜ì§€ì£¼ì˜ì— ë§ì„œ <strong>'ìœ¡ì²´ì˜ êµ¬ì›'</strong>ì„ ê°€ì¥ ê°•ë ¥í•˜ê²Œ ë³€í˜¸í•©ë‹ˆë‹¤. ê·¸ë¦¬ìŠ¤ë„ ì•ˆì—ì„œ ë§Œë¬¼ì´ í†µì¼(Recapitulation)ë¨ì„ ê°•ì¡°í•©ë‹ˆë‹¤.</p>` },
            { title: "ì˜¤ë¦¬ê²: ë§Œìœ íšŒë³µ", subtitle: "êµë¶€ ì‹ í•™ 2", badge: "Origen", layers: ['hellenism', 'judaism', 'irenaeus', 'origen'], desc: `<p><strong>ì˜ì  í•´ì„ì˜ ì‹¬í™”:</strong></p><p>ìœ¡ì²´ë³´ë‹¤ëŠ” ì˜í˜¼ì˜ êµìœ¡ê³¼ ìƒìŠ¹ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤. ëª¨ë“  ì¡´ì¬ê°€ ê²°êµ­ í•˜ë‚˜ë‹˜ê»˜ ëŒì•„ê°„ë‹¤ëŠ” <strong>'ë§Œìœ íšŒë³µ'</strong>ì„ í†µí•´ ìš°ì£¼ì  ë²”ìœ„ë¥¼ ë„“í™ë‹ˆë‹¤.</p>` },
            { title: "ì•„ìš°êµ¬ìŠ¤í‹°ëˆ„ìŠ¤: ë‘ ë„ì„±", subtitle: "êµë¶€ ì‹ í•™ 3", badge: "Augustine", layers: ['hellenism', 'judaism', 'irenaeus', 'origen', 'augustine'], desc: `<p><strong>ì„œêµ¬ ì‹ í•™ì˜ ê¸°ì´ˆ:</strong></p><p>ë‚´ë©´ì˜ ê¹Šì€ ì„±ì°°(ê³ ë°±ë¡)ê³¼ ê±°ëŒ€í•œ ì—­ì‚¬ê´€(ì‹ êµ­ë¡ )ì„ ê²°í•©í•©ë‹ˆë‹¤. í—¬ë¼ì  ë‚´ë©´ì„±ê³¼ ìœ ëŒ€ì  ì—­ì‚¬ì„±ì„ ì¢…í•©í•˜ëŠ” ê±°ëŒ€í•œ íë¦„ì„ ë§Œë“­ë‹ˆë‹¤.</p>` },
            { title: "í† ë§ˆìŠ¤ ì•„í€´ë‚˜ìŠ¤: ì€ì´ê³¼ ìì—°", subtitle: "ì¤‘ì„¸ ì‹ í•™", badge: "Aquinas", layers: ['hellenism', 'judaism', 'irenaeus', 'origen', 'augustine', 'aquinas'], desc: `<p><strong>ì´ì„±ì˜ ì²´ê³„í™”:</strong></p><p>ì•„ë¦¬ìŠ¤í† í…”ë ˆìŠ¤ë¥¼ ìˆ˜ìš©í•˜ì—¬ ì‹ ì•™ê³¼ ì´ì„±, ì€ì´ê³¼ ìì—°ì˜ ì¡°í™”ë¥¼ ì´ë£¹ë‹ˆë‹¤. ë¶€í™œ ì‹ ì•™ì„ ì´ì„±ì  ì²´ê³„ ì•ˆì—ì„œ ì •ë¦½í•˜ë ¤ í–ˆìŠµë‹ˆë‹¤.</p>` },
            { title: "ë§ˆë¥´í‹´ ë£¨í„°: ì‹­ìê°€ì™€ ë¯¿ìŒ", subtitle: "ì¢…êµê°œí˜ 1", badge: "Luther", layers: ['hellenism', 'judaism', 'luther'], desc: `<p class="bg-red-50 text-red-900 p-3 rounded mb-2"><strong>ì˜¤ì§ ë¯¿ìŒ (Sola Fide)</strong></p><p>ë£¨í„°(ë¶‰ì€ìƒ‰)ëŠ” ì¤‘ì„¸ì˜ ì˜ê´‘ì„ ê±°ë¶€í•˜ê³ , <strong>ì‹­ìê°€ ì‹ í•™</strong>ê³¼ <strong>ê°œì¸ì˜ ì‹¤ì¡´ì  ë¯¿ìŒ(7ì‹œ)</strong>ì— ì§‘ì¤‘í•©ë‹ˆë‹¤. ë§ì”€(8ì‹œ)ì˜ ê¶Œìœ„ë¥¼ ì„¸ìš°ë©° ë‚´ë©´ì  í™•ì‹ ì„ ê°•ì¡°í•©ë‹ˆë‹¤.</p>` },
            { title: "ì¥ ì¹¼ë±…: ì˜ê´‘ì˜ ë¬´ëŒ€", subtitle: "ì¢…êµê°œí˜ 2", badge: "Calvin", layers: ['hellenism', 'judaism', 'luther', 'calvin'], desc: `<p class="bg-cyan-50 text-cyan-900 p-3 rounded mb-2"><strong>í•˜ë‚˜ë‹˜ì˜ ì ˆëŒ€ ì£¼ê¶Œ</strong></p><p>ì¹¼ë±…(ì²­ë¡ìƒ‰)ì€ ë£¨í„°ì˜ ì‹ ì•™ì„ <strong>ìš°ì£¼ì  ì˜ê´‘ì˜ ë¬´ëŒ€(Theatrum Gloriae)</strong>ë¡œ í™•ì¥í•©ë‹ˆë‹¤. <strong>ì´ì„±/ìš°ì£¼(6ì‹œ)</strong>ì™€ <strong>ì •ì¹˜/ì‚¬íšŒ(10ì‹œ)</strong> ì˜ì—­ìœ¼ë¡œ í•˜ë‚˜ë‹˜ì˜ í†µì¹˜ë¥¼ ë„“í™ë‹ˆë‹¤.</p>` },
            { title: "ìŠë¼ì´ì–´ë§ˆí—ˆ: ê°ì •ì˜ ì°¸í˜¸", subtitle: "ê·¼í˜„ëŒ€ì‹ í•™ì 1", badge: "Liberalism", layers: ['hellenism', 'judaism', 'schleiermacher'], desc: `<p>19ì„¸ê¸° ììœ ì£¼ì˜ëŠ” ì œ2ì „ì„ ì„ 'ì´ì„±'ì—ì„œ 'ê°ì •'ìœ¼ë¡œ ë°”ê¾¸ì–´ ë”ìš± ê¹Šì€ ì°¸í˜¸ë¥¼ íŒë‹ˆë‹¤.</p>` },
            { title: "ë°”ë¥´íŠ¸: ê°ê´€ì„±ì˜ ê³µì¤‘ í­ê²©", subtitle: "ê·¼í˜„ëŒ€ì‹ í•™ì 2", badge: "Barth", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth'], desc: `<p><strong>ì œ1ì „ì„  íƒˆí™˜ ì‘ì „:</strong></p><p>ì¸ê°„ì˜ ê°ì •ì´ ì•„ë‹Œ, ìœ„ë¡œë¶€í„° ë‚´ë ¤ê½‚íˆëŠ” í•˜ë‚˜ë‹˜ ë§ì”€ì˜ ê°ê´€ì„±ì„ ì„ í¬í•©ë‹ˆë‹¤.</p>` },
            { title: "ë¶ˆíŠ¸ë§Œ: ì‹¤ì¡´ì˜ ìš”ìƒˆ", subtitle: "ê·¼í˜„ëŒ€ì‹ í•™ì 3", badge: "Bultmann", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann'], desc: `<p><strong>í—¬ë¼ì™€ì˜ ì™„ë²½í•œ ì¼ì¹˜:</strong></p><p>í˜„ëŒ€ì¸ì—ê²Œ ë¹ˆ ë¬´ë¤ì€ ì‹ í™”ì…ë‹ˆë‹¤. ê·¸ë˜í”„ê°€ íšŒìƒ‰(í—¬ë¼) ì˜í† ì™€ ê²¹ì¹˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì„¸ìš”.</p>` },
            { title: "ë³¸íšŒí¼: ì‹¤ì²œìœ¼ë¡œì˜ ëŒê²©", subtitle: "ê·¼í˜„ëŒ€ì‹ í•™ì 4", badge: "Bonhoeffer", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann', 'bonhoeffer'], desc: `<p><strong>ì œ3ì „ì„ ìœ¼ë¡œ ì§„ê²©:</strong></p><p>ë¯¸ë˜ë³´ë‹¤ í˜„ì¬ì˜ ìœ¤ë¦¬ì  í–‰ë™(10ì‹œ)ì„ ì„ íƒí•œ êµµì€ ì„ ì„ ì£¼ëª©í•˜ì„¸ìš”.</p>` },
            { title: "ëª°íŠ¸ë§Œ: í¬ë§ì˜ ì˜í†  ìˆ˜ë³µ", subtitle: "ê·¼í˜„ëŒ€ì‹ í•™ì 5", badge: "Moltmann", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann', 'bonhoeffer', 'moltmann'], desc: `<p><strong>ìœ ëŒ€ì  ì§€ì¸µì˜ ë¶€í™œ:</strong></p><p>ë¶ˆíŠ¸ë§Œì´ í¬ê¸°í–ˆë˜ ì—­ì‚¬(2ì‹œ)ì™€ ì •ì¹˜(10ì‹œ)ë¥¼ ì „ë©´ì ìœ¼ë¡œ ìˆ˜ë³µí•˜ì—¬ 'í¬ë§ì˜ ì‹ í•™'ì„ ì™„ì„±í•©ë‹ˆë‹¤.</p>` },
            { title: "íŒë„¨ë² ë¥´í¬: ì´ì„±ì˜ ìš”ìƒˆ", subtitle: "ê·¼í˜„ëŒ€ì‹ í•™ì 6", badge: "Pannenberg", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann', 'bonhoeffer', 'moltmann', 'pannenberg'], desc: `<p><strong>ë³´í¸ì‚¬ì  ì¦ëª…:</strong></p><p>ëª°íŠ¸ë§Œì´ ì‹¤ì²œì— ì£¼ë ¥í–ˆë‹¤ë©´, íŒë„¨ë² ë¥´í¬ëŠ” ì œ1ì „ì„ (ê°ê´€ì„±)ì„ ì´ì„±ì˜ ì–¸ì–´ë¡œ ìš”ìƒˆí™”í•©ë‹ˆë‹¤.</p>` },
            { title: "ì¢…í•© ì „í™© ë³´ê³ ", subtitle: "ìµœì¢… ê²°ë¡ ", badge: "Conclusion", layers: Object.keys(allLayers).filter(k => !['irenaeus', 'origen', 'augustine', 'aquinas'].includes(k)), desc: `<h3 class="font-bold mb-2">ë‹¹ì‹ ì˜ ì „ì„ ì€ ì–´ë””ì…ë‹ˆê¹Œ?</h3><ul class="text-sm space-y-2"><li>ğŸ›‘ ì£¼ê´€ì£¼ì˜: ì˜ë¯¸ë¥¼ ì„ íƒ (ë¶ˆíŠ¸ë§Œ, ìŠë¼ì´ì–´ë§ˆí—ˆ)</li><li>ğŸŒ ì—­ì‚¬/í¬ë§: ì‚¬ì‹¤ê³¼ ë³€í˜ (ëª°íŠ¸ë§Œ, íŒë„¨ë² ë¥´í¬, ì¹¼ë±…)</li><li>âš–ï¸ ê· í˜•: ë§ì”€ê³¼ ì‹¤ì²œ (ë°”ë¥´íŠ¸, ë³¸íšŒí¼, ë£¨í„°)</li></ul>` }
        ];

        // --- Core Functions ---
        let currentStep = 0;
        let chartInstance = null;
        let currentMode = 'story';
        const customSelection = new Set();

        function initCustomControls() {
            const rootContainer = document.getElementById('controls-roots');
            const medievalContainer = document.getElementById('controls-medieval');
            const reformationContainer = document.getElementById('controls-reformation');
            const modernContainer = document.getElementById('controls-moderns');

            Object.values(allLayers).forEach(layer => {
                const el = document.createElement('div');
                el.className = 'flex items-center justify-between p-3 bg-white border border-slate-100 rounded-lg shadow-sm hover:border-indigo-200 transition-colors cursor-pointer';
                el.onclick = (e) => {
                    if (e.target.type !== 'checkbox') toggleCustomLayer(layer.id);
                };

                el.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="w-3 h-3 rounded-full shadow-sm" style="background-color: ${layer.borderColor}"></span>
                        <div>
                            <div class="font-bold text-sm text-slate-800">${layer.label}</div>
                            <div class="text-xs text-slate-500">${layer.desc}</div>
                        </div>
                    </div>
                    <input type="checkbox" id="check-${layer.id}" class="w-5 h-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 cursor-pointer" onchange="toggleCustomLayer('${layer.id}')">
                `;

                if (layer.type === 'root') rootContainer.appendChild(el);
                else if (layer.type === 'medieval') medievalContainer.appendChild(el);
                else if (layer.type === 'reformation') reformationContainer.appendChild(el);
                else modernContainer.appendChild(el);
            });
        }

        function switchMode(mode) {
            currentMode = mode;
            const storyTab = document.getElementById('mode-tab-story');
            const customTab = document.getElementById('mode-tab-custom');
            const storyPanel = document.getElementById('story-panel');
            const customPanel = document.getElementById('custom-panel');
            const timeline = document.getElementById('timeline-wrapper');
            const navControls = document.getElementById('nav-controls');
            const btnReset = document.getElementById('btn-reset');

            if (mode === 'story') {
                storyTab.className = "flex-1 py-3 lg:py-4 text-xs lg:text-sm font-bold uppercase tracking-wide border-b-2 border-indigo-600 text-indigo-600 bg-indigo-50/50 transition-colors";
                customTab.className = "flex-1 py-3 lg:py-4 text-xs lg:text-sm font-bold uppercase tracking-wide border-b-2 border-transparent text-slate-400 hover:text-slate-600 hover:bg-slate-50 transition-colors";
                storyPanel.classList.remove('hidden');
                customPanel.classList.add('hidden');
                timeline.style.opacity = '1';
                navControls.style.display = 'flex';
                btnReset.style.display = 'none';
                updateView();
            } else {
                customTab.className = "flex-1 py-3 lg:py-4 text-xs lg:text-sm font-bold uppercase tracking-wide border-b-2 border-indigo-600 text-indigo-600 bg-indigo-50/50 transition-colors";
                storyTab.className = "flex-1 py-3 lg:py-4 text-xs lg:text-sm font-bold uppercase tracking-wide border-b-2 border-transparent text-slate-400 hover:text-slate-600 hover:bg-slate-50 transition-colors";
                storyPanel.classList.add('hidden');
                customPanel.classList.remove('hidden');
                timeline.style.opacity = '0';
                navControls.style.display = 'none';
                btnReset.style.display = 'block';
                updateCustomChart();
            }
        }

        function toggleCustomLayer(id) {
            const checkbox = document.getElementById(`check-${id}`);
            if (checkbox.checked !== customSelection.has(id)) checkbox.checked = !checkbox.checked;
            if (customSelection.has(id)) { customSelection.delete(id); checkbox.checked = false; }
            else { customSelection.add(id); checkbox.checked = true; }
            updateCustomChart();
        }

        function resetCustom() {
            customSelection.clear();
            document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
            updateCustomChart();
        }

        function updateCustomChart() {
            const datasets = Array.from(customSelection).map(id => getDataset(id));
            chartInstance.data.datasets = datasets;
            chartInstance.update();
            const insightText = generateInsight(customSelection);
            document.getElementById('insight-text').innerHTML = insightText;
        }

        function initChart() {
            const ctx = document.getElementById('theologyChart').getContext('2d');
            const fontConfig = { family: "'Noto Sans KR', sans-serif", size: 11, weight: '600' };

            chartInstance = new Chart(ctx, {
                type: 'radar',
                data: { labels: labels, datasets: [] },
                options: {
                    responsive: true, maintainAspectRatio: false, layout: { padding: 10 },
                    scales: {
                        r: {
                            min: 0, max: 5, ticks: { display: false, stepSize: 1 },
                            pointLabels: {
                                font: fontConfig,
                                color: (ctx) => {
                                    const i = ctx.index;
                                    if ([0, 1, 6].includes(i)) return '#2563eb';
                                    if ([4, 5].includes(i)) return '#db2777';
                                    if ([2, 3].includes(i)) return '#0d9488';
                                    return '#64748b';
                                }
                            },
                            grid: { color: 'rgba(203, 213, 225, 0.4)', circular: true }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: true, backgroundColor: 'rgba(255, 255, 255, 0.95)', titleColor: '#1e293b', bodyColor: '#475569', borderColor: '#e2e8f0', borderWidth: 1, usePointStyle: true }
                    },
                    animation: { duration: 500, easing: 'easeOutQuad' }
                }
            });
        }

        function updateView() {
            const step = steps[currentStep];
            document.getElementById('step-title').textContent = step.title;
            document.getElementById('step-subtitle').textContent = step.subtitle;
            document.getElementById('step-desc').innerHTML = step.desc;
            document.getElementById('step-counter').textContent = `0${currentStep + 1} / 16`;
            document.getElementById('insight-text').innerHTML = `ğŸ’¡ <strong>Insight:</strong> ${storyInsights[currentStep]}`;

            const datasets = step.layers.map(id => getDataset(id));
            chartInstance.data.datasets = datasets;
            chartInstance.update();

            const timelineContainer = document.getElementById('timeline-container');
            timelineContainer.innerHTML = steps.map((_, idx) => `
                <div id="step-marker-${idx}" class="step-marker w-2 h-2 md:w-3 md:h-3 rounded-full bg-slate-200 border border-slate-300 transition-all duration-300 ${idx === currentStep ? 'active' : (idx < currentStep ? 'visited' : '')}"></div>
            `).join('');

            document.getElementById('btn-prev').disabled = currentStep === 0;
            const nextBtn = document.getElementById('btn-next');
            nextBtn.disabled = currentStep === steps.length - 1;
            nextBtn.innerHTML = currentStep === steps.length - 1 ? '<span>ë¶„ì„ ì™„ë£Œ</span>' : '<span>ë‹¤ìŒ ë¶„ì„</span><svg class="w-5 h-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>';
        }

        function nextStep() { if (currentStep < steps.length - 1) { currentStep++; updateView(); } }
        function prevStep() { if (currentStep > 0) { currentStep--; updateView(); } }

        function init() {
            initCustomControls();
            initChart();
            updateView();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>