<!DOCTYPE html>
<html lang="ko" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³„ì‹œ ë…¼ìŸì˜ 3ëŒ€ ì „ì„ : ì‹ í•™ ìƒí™©ì‹¤ (Dark Ops)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Noto+Sans+KR:wght@300;400;600;800&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'Noto Sans KR', 'sans-serif'],
                    },
                    colors: {
                        'neon-blue': '#00f3ff',
                        'neon-pink': '#ff00ff',
                        'neon-green': '#00ff9d',
                        'dark-bg': '#0f172a',
                        'glass-bg': 'rgba(30, 41, 59, 0.7)',
                        'glass-border': 'rgba(255, 255, 255, 0.1)',
                    },
                    boxShadow: {
                        'neon': '0 0 10px rgba(0, 243, 255, 0.5), 0 0 20px rgba(0, 243, 255, 0.3)',
                        'neon-pink': '0 0 10px rgba(255, 0, 255, 0.5), 0 0 20px rgba(255, 0, 255, 0.3)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #020617;
            background-image: 
                radial-gradient(circle at 50% 0%, #1e1b4b 0%, transparent 40%),
                radial-gradient(circle at 0% 90%, #312e81 0%, transparent 30%);
            color: #e2e8f0;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 2px;
        }

        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        .layer-item {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .layer-item.inactive {
            opacity: 0.4;
            filter: grayscale(0.8);
        }

        .layer-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }

        .layer-item.selected {
            background: rgba(0, 243, 255, 0.1);
            border-left: 2px solid #00f3ff;
        }

        .step-pill {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .step-pill::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: 0.5s;
        }

        .step-pill:hover::after {
            transform: translateX(100%);
        }

        .step-pill.active {
            background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
            color: #fff;
            box-shadow: 0 0 15px rgba(79, 70, 229, 0.5);
            border: 1px solid rgba(129, 140, 248, 0.4);
        }

        /* Chart Animation */
        canvas {
            filter: drop-shadow(0 0 8px rgba(99, 102, 241, 0.2));
        }
    </style>
</head>

<body class="min-h-screen flex flex-col overflow-x-hidden">

    <!-- í—¤ë” -->
    <header class="h-16 glass-panel border-b-0 border-b-slate-700/50 z-50 px-6 flex justify-between items-center shrink-0 mb-1 mx-2 mt-2 rounded-2xl">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center border border-indigo-500/30 text-2xl shadow-neon">
                ğŸ›¸
            </div>
            <div>
                <h1 class="text-lg font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-indigo-400 tracking-tight">THEOLOGY OPS</h1>
                <p class="text-[10px] text-slate-500 font-bold tracking-[0.2em] uppercase">Revelation Warfare Map v2.0</p>
            </div>
        </div>
        
        <div id="progress-bar" class="hidden lg:flex items-center gap-1 bg-slate-900/50 rounded-full px-2 py-1.5 border border-slate-700/50"></div>
        
        <div class="flex items-center gap-3">
            <div class="flex bg-slate-900/50 rounded-full p-1 border border-slate-700/50">
                <button onclick="switchMode('story')" id="btn-mode-story"
                    class="px-4 py-1.5 text-xs font-bold rounded-full transition-all duration-300">STORY</button>
                <button onclick="switchMode('custom')" id="btn-mode-custom"
                    class="px-4 py-1.5 text-xs font-bold rounded-full transition-all duration-300">COMPARE</button>
            </div>
        </div>
    </header>

    <!-- ëª¨ë°”ì¼ íƒ­ -->
    <div class="lg:hidden flex glass-panel mx-2 mt-2 rounded-xl border-b-0 mb-1">
        <button onclick="showMobileTab('chart')" id="tab-chart" class="flex-1 py-3 text-xs font-bold text-center border-b-2 border-cyan-500 text-cyan-400">RADAR</button>
        <button onclick="showMobileTab('layers')" id="tab-layers" class="flex-1 py-3 text-xs font-bold text-center border-b-2 border-transparent text-slate-500">LAYERS</button>
        <button onclick="showMobileTab('story')" id="tab-story" class="flex-1 py-3 text-xs font-bold text-center border-b-2 border-transparent text-slate-500">INTEL</button>
    </div>

    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden p-2 gap-2">
        <!-- ì¢Œì¸¡: ë ˆì´ì–´ ì„ íƒ íŒ¨ë„ -->
        <aside id="panel-layers"
            class="hidden lg:flex w-full lg:w-72 glass-panel rounded-2xl flex-col shrink-0 overflow-hidden">
            <div class="p-5 border-b border-slate-700/30 shrink-0 bg-slate-800/20">
                <h3 class="text-xs font-extrabold text-cyan-500 uppercase tracking-widest flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-cyan-500 animate-pulse"></span>
                    Layer Control
                </h3>
                <p id="layer-mode-hint" class="text-[10px] text-slate-500 mt-2 font-mono">STATUS: AUTO_PILOT_ENGAGED</p>
            </div>
            <div class="flex-1 overflow-y-auto custom-scroll p-4 space-y-6">
                <div>
                    <h4 class="text-[10px] font-bold text-slate-500 uppercase mb-3 px-2 border-l-2 border-slate-600">Ancient Origins</h4>
                    <div id="layer-roots" class="space-y-1"></div>
                </div>
                <div>
                    <h4 class="text-[10px] font-bold text-slate-500 uppercase mb-3 px-2 border-l-2 border-slate-600">Medieval Era</h4>
                    <div id="layer-medieval" class="space-y-1"></div>
                </div>
                <div>
                    <h4 class="text-[10px] font-bold text-slate-500 uppercase mb-3 px-2 border-l-2 border-slate-600">Reformation</h4>
                    <div id="layer-reformation" class="space-y-1"></div>
                </div>
                <div>
                    <h4 class="text-[10px] font-bold text-slate-500 uppercase mb-3 px-2 border-l-2 border-slate-600">Modern Theology</h4>
                    <div id="layer-modern" class="space-y-1"></div>
                </div>
            </div>
        </aside>

        <!-- ì¤‘ì•™: ì°¨íŠ¸ -->
        <div id="panel-chart"
            class="flex-1 flex items-center justify-center p-4 lg:p-8 relative min-h-[50vh] lg:min-h-0 glass-panel rounded-2xl">
            <!-- Grid Background -->
            <div class="absolute inset-0 opacity-10 bg-[linear-gradient(rgba(255,255,255,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.1)_1px,transparent_1px)] bg-[size:40px_40px]"></div>
            
            <div class="relative w-full max-w-sm lg:max-w-[75vh] aspect-square">
                <!-- Outer Glow -->
                <div class="absolute inset-0 bg-indigo-500/10 rounded-full blur-3xl animate-pulse"></div>
                
                <div class="relative z-10 p-2 h-full">
                    <canvas id="theologyChart" class="w-full h-full"></canvas>
                </div>
            </div>
        </div>

        <!-- ìš°ì¸¡: ìŠ¤í† ë¦¬ + ì¸ì‚¬ì´íŠ¸ -->
        <aside id="panel-story"
            class="hidden lg:flex w-full lg:w-96 glass-panel rounded-2xl flex-col shrink-0 overflow-hidden max-h-[50vh] lg:max-h-full">
            <div class="flex-[7] flex flex-col overflow-hidden border-b border-slate-700/30">
                <div class="p-5 border-b border-slate-700/30 shrink-0 flex items-center gap-3 bg-slate-800/20">
                    <span id="detail-badge"
                        class="px-3 py-1 rounded border border-indigo-500/50 text-[10px] font-bold bg-indigo-500/20 text-indigo-300 uppercase tracking-wider shadow-neon">Overview</span>
                    <h2 id="detail-title" class="text-lg font-bold text-white tracking-tight"></h2>
                </div>
                <div id="detail-desc"
                    class="flex-1 overflow-y-auto custom-scroll p-6 prose prose-invert prose-sm max-w-none leading-relaxed text-slate-300"></div>
            </div>
            
            <div class="flex-[3] flex flex-col overflow-hidden bg-slate-900/30">
                <div class="flex items-center justify-between px-5 py-3 border-b border-slate-700/30 shrink-0 bg-slate-800/40">
                    <div class="flex items-center gap-2">
                        <span class="text-sm">âš¡</span>
                        <span class="text-[10px] font-bold text-amber-400 uppercase tracking-widest">Tactical Analysis</span>
                    </div>
                    <span id="insight-badge"
                        class="text-[10px] font-mono px-2 py-0.5 rounded bg-slate-800 text-slate-400 border border-slate-700">STEP 01</span>
                </div>
                <div class="flex-1 overflow-y-auto custom-scroll p-5 min-h-0">
                    <div id="insight-text" class="text-sm text-slate-300 leading-relaxed font-light border-l-2 border-amber-500/50 pl-3"></div>
                </div>
                <div id="story-nav" class="flex border-t border-slate-700/30 shrink-0 h-12">
                    <button onclick="prevStep()" id="btn-prev"
                        class="flex-1 text-xs font-bold text-slate-400 hover:bg-white/5 hover:text-white transition-colors disabled:opacity-20 disabled:hover:bg-transparent">
                        &larr; PREV
                    </button>
                    <div class="w-px bg-slate-700/30"></div>
                    <button onclick="nextStep()" id="btn-next"
                        class="flex-1 text-xs font-bold text-cyan-400 hover:bg-cyan-950/30 transition-colors border-l border-slate-700/30">
                        NEXT &rarr;
                    </button>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // ëª¨ë°”ì¼ íƒ­ ì „í™˜
        function showMobileTab(tab) {
            const tabs = ['chart', 'layers', 'story'];
            tabs.forEach(t => {
                const panel = document.getElementById('panel-' + t);
                const tabBtn = document.getElementById('tab-' + t);
                if (t === tab) {
                    panel.classList.remove('hidden');
                    panel.classList.add('flex');
                    tabBtn.classList.add('border-cyan-500', 'text-cyan-400');
                    tabBtn.classList.remove('border-transparent', 'text-slate-500');
                } else {
                    if (window.innerWidth < 1024) {
                        panel.classList.add('hidden');
                        panel.classList.remove('flex');
                    }
                    tabBtn.classList.remove('border-cyan-500', 'text-cyan-400');
                    tabBtn.classList.add('border-transparent', 'text-slate-500');
                }
            });
        }

        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                document.getElementById('panel-layers').classList.remove('hidden');
                document.getElementById('panel-layers').classList.add('flex');
                document.getElementById('panel-chart').classList.remove('hidden');
                document.getElementById('panel-chart').classList.add('flex');
                document.getElementById('panel-story').classList.remove('hidden');
                document.getElementById('panel-story').classList.add('flex');
            } else {
                document.getElementById('panel-layers').classList.add('hidden');
                document.getElementById('panel-layers').classList.remove('flex');
                document.getElementById('panel-story').classList.add('hidden');
                document.getElementById('panel-story').classList.remove('flex');
                document.getElementById('panel-chart').classList.remove('hidden');
                document.getElementById('panel-chart').classList.add('flex');
            }
        });

        const labels = [
            ['ìì—° ê³„ì‹œ', 'NATURAL'],
            ['ì—­ì‚¬ì„±', 'HISTORY'],
            ['ìš°ì£¼ì ', 'COSMIC'],
            ['ì‹¤ì¡´ì ', 'EXISTENTIAL'],
            ['í˜„ì¬ì ', 'PRESENT'],
            ['ì„±ê²½', 'SCRIPTURE'],
            ['ì´ˆì›”', 'TRANSCEND']
        ];
        
        const axisMeanings = [
            { name: "ìì—° ê³„ì‹œ", desc: "ì´ì„±ê³¼ ìì—°ì„ í†µí•œ ì•", cat: "ê°ê´€" },
            { name: "ì—­ì‚¬ì  ê°ê´€ì„±", desc: "ê²€ì¦ ê°€ëŠ¥í•œ ì—­ì‚¬ì  ì‚¬ê±´", cat: "ê°ê´€" },
            { name: "ìš°ì£¼ì  ë²”ìœ„", desc: "í”¼ì¡°ì„¸ê³„ ì „ì²´ í¬ê´„", cat: "ê°ê´€" },
            { name: "ì‹¤ì¡´ì  ë§Œë‚¨", desc: "ì£¼ê´€ì  ê²°ë‹¨ê³¼ ë§Œë‚¨", cat: "ì£¼ê´€" },
            { name: "í˜„ì¬ì  ë§ì”€", desc: "ì˜¤ëŠ˜ë„ ë§ì”€í•˜ì‹œëŠ” í•˜ë‚˜ë‹˜", cat: "ì£¼ê´€" },
            { name: "ì„±ê²½ ì¤‘ì‹¬ì„±", desc: "ì„±ê²½ì´ ìœ ì¼í•œ ê·œë²”", cat: "ì´ˆì›”" },
            { name: "ì‹ ë¹„/ì´ˆì›”", desc: "ì—¬ì „íˆ ì‹ ë¹„ë¡œ ë‚¨ëŠ” í•˜ë‚˜ë‹˜", cat: "ì´ˆì›”" }
        ];

        const allLayers = {
            hellenism: { id: 'hellenism', label: 'í—¬ë¼ ì² í•™', desc: 'LOGOS & REASON', data: [5, 2, 4, 3, 1, 1, 2], borderColor: '#94a3b8', type: 'root' },
            judaism: { id: 'judaism', label: 'ìœ ëŒ€êµ', desc: 'TORAH & HISTORY', data: [2, 5, 3, 2, 3, 5, 5], borderColor: '#fbbf24', type: 'root' },
            irenaeus: { id: 'irenaeus', label: 'ì´ë ˆë„¤ìš°ìŠ¤', desc: 'RECAPITULATION', data: [3, 4, 5, 3, 3, 5, 4], borderColor: '#a3e635', type: 'medieval' },
            augustine: { id: 'augustine', label: 'ì•„ìš°êµ¬ìŠ¤í‹°ëˆ„ìŠ¤', desc: 'INNER LIGHT', data: [4, 4, 3, 5, 4, 5, 5], borderColor: '#f97316', type: 'medieval' },
            aquinas: { id: 'aquinas', label: 'ì•„í€´ë‚˜ìŠ¤', desc: 'NATURE + GRACE', data: [5, 4, 5, 2, 2, 4, 3], borderColor: '#3b82f6', type: 'medieval' },
            luther: { id: 'luther', label: 'ë£¨í„°', desc: 'SOLA SCRIPTURA', data: [1, 3, 2, 5, 5, 5, 4], borderColor: '#f43f5e', type: 'reformation' },
            calvin: { id: 'calvin', label: 'ì¹¼ë±…', desc: 'HS WITNESS', data: [2, 4, 4, 4, 4, 5, 5], borderColor: '#06b6d4', type: 'reformation' },
            schleiermacher: { id: 'schleiermacher', label: 'ìŠë¼ì´ì–´ë§ˆí—ˆ', desc: 'DEPENDENCE', data: [3, 1, 2, 5, 4, 2, 3], borderColor: '#d946ef', type: 'modern' },
            barth: { id: 'barth', label: 'ë°”ë¥´íŠ¸', desc: 'NEIN!', data: [1, 3, 3, 3, 5, 5, 5], borderColor: '#22c55e', type: 'modern' },
            bultmann: { id: 'bultmann', label: 'ë¶ˆíŠ¸ë§Œ', desc: 'EXISTENTIAL', data: [1, 1, 1, 5, 4, 3, 2], borderColor: '#6366f1', type: 'modern' },
            bonhoeffer: { id: 'bonhoeffer', label: 'ë³¸íšŒí¼', desc: 'RELIGIONLESS', data: [2, 3, 3, 5, 5, 4, 4], borderColor: '#a855f7', type: 'modern' },
            pannenberg: { id: 'pannenberg', label: 'íŒë„¨ë² ë¥´í¬', desc: 'REV. AS HISTORY', data: [4, 5, 5, 1, 2, 4, 2], borderColor: '#ef4444', type: 'modern' }
        };

        function getDataset(key) {
            const l = allLayers[key];
            const isRoot = l.type === 'root';
            // Neon Effect Colors
            return { 
                label: l.label, 
                data: l.data, 
                backgroundColor: l.borderColor + '15', // very transparent
                borderColor: l.borderColor, 
                borderWidth: isRoot ? 1 : 2, 
                borderDash: isRoot ? [4, 4] : [], 
                pointBackgroundColor: '#0f172a',
                pointBorderColor: l.borderColor,
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointHoverBackgroundColor: l.borderColor,
                pointHoverBorderColor: '#fff',
                tension: 0.1
            };
        }

        function generateInsight(ids) {
            if (ids.length === 0) return "ë¶„ì„í•  ë°ì´í„° ë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì‹­ì‹œì˜¤.";
            if (ids.length === 1) return '<strong class="text-white">' + allLayers[ids[0]].label + ':</strong> ' + allLayers[ids[0]].desc + '<br><span class="text-xs text-slate-400">ë‹¨ì¼ ë ˆì´ì–´ ë¶„ì„ ëª¨ë“œ</span>';
            if (ids.length === 2) {
                const l1 = allLayers[ids[0]], l2 = allLayers[ids[1]];
                let maxDiff = 0, maxIdx = 0;
                for (let i = 0; i < 7; i++) { const d = Math.abs(l1.data[i] - l2.data[i]); if (d > maxDiff) { maxDiff = d; maxIdx = i; } }
                return '<strong class="text-cyan-400">ê²©ì „ì§€ ê°ì§€ [' + axisMeanings[maxIdx].name + ']:</strong><br>' + l1.label + ' (' + l1.data[maxIdx] + ') vs ' + l2.label + ' (' + l2.data[maxIdx] + ')';
            }
            const layers = ids.map(id => allLayers[id]);
            const avgs = new Array(7).fill(0);
            for (let i = 0; i < 7; i++) { layers.forEach(l => avgs[i] += l.data[i]); avgs[i] /= layers.length; }
            const maxIdx = avgs.indexOf(Math.max(...avgs));
            const minIdx = avgs.indexOf(Math.min(...avgs));
            return '<strong class="text-emerald-400">ê³µí†µ ë¶„ëª¨:</strong> ' + axisMeanings[maxIdx].name + '<br><strong class="text-rose-400">ì „ëµì  ë§¹ì :</strong> ' + axisMeanings[minIdx].name;
        }

        const storyInsights = [
            "ê³„ì‹œ ë…¼ìŸì€ <strong class='text-blue-400'>ê°ê´€</strong>, <strong class='text-pink-400'>ì£¼ê´€</strong>, <strong class='text-emerald-400'>ì´ˆì›”</strong>ì˜ 3ëŒ€ ì „ì„ ì—ì„œ í¼ì³ì§‘ë‹ˆë‹¤.",
            "í—¬ë¼ ì² í•™: <strong class='text-white'>LOGOS</strong> - ì´ì„±ìœ¼ë¡œ ë„ë‹¬í•˜ëŠ” ì‹ .",
            "ìœ ëŒ€êµ: <strong class='text-amber-400'>HISTORY</strong> - ì—­ì‚¬ ì†ì— ê°œì…í•˜ëŠ” ì‹ .",
            "ì´ë ˆë„¤ìš°ìŠ¤: <strong class='text-lime-400'>TRADITION</strong> - ì‚¬ë„ì  ì „ìŠ¹ì˜ ìˆ˜í˜¸.",
            "ì•„ìš°êµ¬ìŠ¤í‹°ëˆ„ìŠ¤: <strong class='text-orange-400'>INNER LIGHT</strong> - ë‚´ë©´ì˜ ë¹›.",
            "ì•„í€´ë‚˜ìŠ¤: <strong class='text-blue-400'>HARMONY</strong> - ìì—°ê³¼ ì€ì´ì˜ ì™„ë²½í•œ ì¡°í™”.",
            "ë£¨í„°: <strong class='text-rose-500'>SOLA SCRIPTURA</strong> - ì˜¤ì§ ë§ì”€ìœ¼ë¡œ íƒ€ê²©í•˜ë¼.",
            "ì¹¼ë±…: <strong class='text-cyan-400'>SPIRIT</strong> - ì„±ë ¹ì˜ ë‚´ì  ì¦ê±°.",
            "ìŠë¼ì´ì–´ë§ˆí—ˆ: <strong class='text-fuchsia-400'>FEELING</strong> - ì ˆëŒ€ ì˜ì¡´ì˜ ê°ì •.",
            "ë°”ë¥´íŠ¸: <strong class='text-green-500'>NEIN!</strong> - ìì—°ê³„ì‹œ ì™„ì „ ê±°ë¶€. ìˆ˜ì§ì  ì¹¨ì….",
            "ë¶ˆíŠ¸ë§Œ: <strong class='text-indigo-400'>EXISTENTIAL</strong> - ì‹¤ì¡´ì  ê²°ë‹¨ê³¼ ë§Œë‚¨.",
            "ë³¸íšŒí¼: <strong class='text-purple-400'>SECULAR</strong> - ì„±ì¸ëœ ì„¸ê³„ì—ì„œì˜ ì‹ ì•™.",
            "íŒë„¨ë² ë¥´í¬: <strong class='text-red-500'>UNIVERSAL</strong> - ì—­ì‚¬ê°€ ê³§ ê³„ì‹œë‹¤.",
            "12ê°œ ë ˆì´ì–´ ì „ê°œ ì™„ë£Œ. ë‹¹ì‹ ì˜ ì‹ í•™ì  ì¢Œí‘œëŠ” ì–´ë””ì…ë‹ˆê¹Œ?"
        ];

        const stepDescriptions = [
            '<h3 class="font-bold text-xl mb-3 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">ğŸ—ºï¸ Operation: Revelation</h3><div class="space-y-4 my-4"><div class="p-3 bg-blue-900/20 border-l-2 border-blue-500 rounded-r"><strong class="text-blue-400 text-xs tracking-widest">OBJECTIVE</strong><p class="text-sm text-slate-300">ì´ì„±/ì—­ì‚¬ë¡œ ê²€ì¦ ê°€ëŠ¥í•œê°€?</p></div><div class="p-3 bg-pink-900/20 border-l-2 border-pink-500 rounded-r"><strong class="text-pink-400 text-xs tracking-widest">SUBJECTIVE</strong><p class="text-sm text-slate-300">ì‹¤ì¡´ì  ë§Œë‚¨ì¸ê°€?</p></div><div class="p-3 bg-emerald-900/20 border-l-2 border-emerald-500 rounded-r"><strong class="text-emerald-400 text-xs tracking-widest">TRANSCENDENT</strong><p class="text-sm text-slate-300">ì‹ ë¹„ë¡œ ë‚¨ëŠ”ê°€?</p></div></div>',
            '<h3 class="font-bold text-xl mb-3 text-slate-200">ğŸ›ï¸ HELLENISM</h3><p>í”Œë¼í†¤ ì´ë˜ ê·¸ë¦¬ìŠ¤ ì² í•™ì€ <strong>ë¡œê³ ìŠ¤(ì´ì„±)</strong>ë¥¼ í†µí•´ ì‹ ì ì¸ ê²ƒì„ íŒŒì•…í•  ìˆ˜ ìˆë‹¤ê³  ë³´ì•˜ìŠµë‹ˆë‹¤.</p><ul class="space-y-2 mt-4 text-xs text-slate-400 font-mono"><li class="flex items-center gap-2"><span class="text-slate-600">>></span> ìì—° ê³„ì‹œ ê·¹ëŒ€í™”</li><li class="flex items-center gap-2"><span class="text-slate-600">>></span> ì˜ì›í•œ ì§„ë¦¬ ì¶”êµ¬</li></ul>',
            '<h3 class="font-bold text-xl mb-3 text-amber-200">âœ¡ï¸ JUDAISM</h3><p>í•˜ë‚˜ë‹˜ì€ <strong>ì—­ì‚¬ ì†ì—ì„œ í–‰ë™í•˜ì‹œëŠ” ë¶„</strong>ì…ë‹ˆë‹¤.</p><ul class="space-y-2 mt-4 text-xs text-slate-400 font-mono"><li class="flex items-center gap-2"><span class="text-amber-600">>></span> ì‹œë‚´ì‚°, ì¶œì• êµ½</li><li class="flex items-center gap-2"><span class="text-amber-600">>></span> ì˜ˆì–¸ìë“¤ì˜ ì„ í¬</li></ul>',
            '<h3 class="font-bold text-xl mb-3 text-lime-200">âš”ï¸ IRENAEUS</h3><p>ì˜ì§€ì£¼ì˜ì˜ ë¹„ë°€ ê³„ì‹œì— ë§ì„œ <strong>ê³µì  ì‚¬ë„ ì „ìŠ¹</strong>ì„ ê°•ì¡°í–ˆìŠµë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-xl mb-3 text-orange-200">ğŸ’¡ AUGUSTINE</h3><p><strong>ë‚´ë©´ì˜ ë¹›(lumen interius)</strong>ì„ í†µí•œ ê³„ì‹œë¥¼ ê°•ì¡°í–ˆìŠµë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-xl mb-3 text-blue-200">âš–ï¸ AQUINAS</h3><p><strong>ìì—°ê³¼ ì€ì´ì˜ ì¡°í™”</strong>ë¥¼ ì²´ê³„í™”í–ˆìŠµë‹ˆë‹¤. ì´ì„±ì€ ì‹ ì•™ì˜ ì˜ˆë¹„ ë‹¨ê³„ì…ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-xl mb-3 text-rose-200">ğŸ“œ LUTHER</h3><p><strong>Sola Scriptura!</strong> ì˜¤ì§ ì„±ê²½ë§Œì´ ê³„ì‹œì˜ ê·œë²”ì…ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-xl mb-3 text-cyan-200">ğŸ•Šï¸ CALVIN</h3><p><strong>ì„±ë ¹ì˜ ë‚´ì  ì¦ê±°</strong>ê°€ ì„±ê²½ì˜ ê¶Œìœ„ë¥¼ í™•ì¦í•©ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-xl mb-3 text-fuchsia-200">ğŸ’­ SCHLEIERMACHER</h3><p>ê³„ì‹œë¥¼ <strong>ì ˆëŒ€ ì˜ì¡´ì˜ ê°ì •</strong>ìœ¼ë¡œ ì¬í•´ì„í–ˆìŠµë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-xl mb-3 text-green-200">ğŸ”¥ BARTH</h3><p>ìì—° ê³„ì‹œì— <strong>"Nein!"</strong>ì„ ì„ ì–¸í•©ë‹ˆë‹¤. í•˜ë‚˜ë‹˜ì€ ì „ì ìœ¼ë¡œ íƒ€ìì´ì‹­ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-xl mb-3 text-indigo-200">ğŸ­ BULTMANN</h3><p>ê³„ì‹œë¥¼ <strong>ì¼€ë¦¬ê·¸ë§ˆì™€ì˜ ì‹¤ì¡´ì  ë§Œë‚¨</strong>ìœ¼ë¡œ í•´ì„í•©ë‹ˆë‹¤. ì—­ì‚¬ì  ì‚¬ì‹¤ë³´ë‹¤ ì‹¤ì¡´ì  ì˜ë¯¸ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-xl mb-3 text-purple-200">ğŸŒ BONHOEFFER</h3><p><strong>ë¹„ì¢…êµì  í•´ì„</strong>ì„ íƒêµ¬í•©ë‹ˆë‹¤. ì„¸ìƒ í•œë³µíŒì—ì„œì˜ ê·¸ë¦¬ìŠ¤ë„.</p>',
            '<h3 class="font-bold text-xl mb-3 text-red-200">ğŸ“š PANNENBERG</h3><p><strong>ì—­ì‚¬ë¡œì„œì˜ ê³„ì‹œ</strong>ë¥¼ ì£¼ì¥í•©ë‹ˆë‹¤. ì—­ì‚¬ì˜ ì¢…ë§(ë¶€í™œ)ì—ì„œ ê³„ì‹œê°€ ì™„ì„±ë©ë‹ˆë‹¤.</p>',
            '<h3 class="font-bold text-xl mb-3 text-slate-200">ğŸ“Š FINAL REPORT</h3><div class="grid grid-cols-2 gap-2 text-xs font-mono mb-4"><div class="p-2 bg-slate-800 rounded border border-slate-700"><span class="text-blue-400">OBJ</span> : Judaism, Pannenberg</div><div class="p-2 bg-slate-800 rounded border border-slate-700"><span class="text-pink-400">SUB</span> : Bultmann, Schleiermacher</div><div class="p-2 bg-slate-800 rounded border border-slate-700"><span class="text-emerald-400">BAL</span> : Barth, Calvin</div><div class="p-2 bg-slate-800 rounded border border-slate-700"><span class="text-amber-400">NAT</span> : Aquinas, Hellenism</div></div><p class="font-medium text-white animate-pulse">ğŸ‘‰ AWAITING YOUR COORDINATES...</p>'
        ];

        const steps = [
            { title: "THE FRONTLINES", badge: "00", layers: [], desc: 0 },
            { title: "HELLENISM", badge: "01", layers: ['hellenism'], desc: 1 },
            { title: "JUDAISM", badge: "02", layers: ['hellenism', 'judaism'], desc: 2 },
            { title: "IRENAEUS", badge: "03", layers: ['hellenism', 'judaism', 'irenaeus'], desc: 3 },
            { title: "AUGUSTINE", badge: "04", layers: ['hellenism', 'judaism', 'irenaeus', 'augustine'], desc: 4 },
            { title: "AQUINAS", badge: "05", layers: ['hellenism', 'judaism', 'irenaeus', 'augustine', 'aquinas'], desc: 5 },
            { title: "LUTHER", badge: "06", layers: ['hellenism', 'judaism', 'luther'], desc: 6 },
            { title: "CALVIN", badge: "07", layers: ['hellenism', 'judaism', 'luther', 'calvin'], desc: 7 },
            { title: "SCHLEIERMACHER", badge: "08", layers: ['hellenism', 'judaism', 'schleiermacher'], desc: 8 },
            { title: "BARTH", badge: "09", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth'], desc: 9 },
            { title: "BULTMANN", badge: "10", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann'], desc: 10 },
            { title: "BONHOEFFER", badge: "11", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann', 'bonhoeffer'], desc: 11 },
            { title: "PANNENBERG", badge: "12", layers: ['hellenism', 'judaism', 'schleiermacher', 'barth', 'bultmann', 'bonhoeffer', 'pannenberg'], desc: 12 },
            { title: "MISSION DEBRIEF", badge: "FIN", layers: Object.keys(allLayers), desc: 13 }
        ];

        let currentStep = 0;
        let currentMode = 'story';
        let chartInstance = null;
        const customSelection = new Set();

        function init() {
            initChart();
            buildProgressBar();
            buildLayerPanel();
            updateView();
        }

        function initChart() {
            Chart.defaults.color = '#94a3b8';
            Chart.defaults.borderColor = 'rgba(148, 163, 184, 0.1)';
            
            chartInstance = new Chart(document.getElementById('theologyChart').getContext('2d'), {
                type: 'radar',
                data: { labels: labels.map(l => l[1]), datasets: [] }, // Use English labels for chart
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { 
                        r: { 
                            min: 0, max: 5, 
                            ticks: { display: false, backdropColor: 'transparent' }, 
                            pointLabels: { 
                                font: { family: "'Outfit'", size: 10, weight: '700' }, 
                                color: '#94a3b8' // Slate 400
                            }, 
                            grid: { color: 'rgba(148,163,184,0.1)', circular: true },
                            angleLines: { color: 'rgba(148,163,184,0.1)' }
                        } 
                    },
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#cbd5e1',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: true,
                            bodyFont: { family: "'Noto Sans KR'" }
                        }
                    },
                    animation: { duration: 600, easing: 'easeOutQuart' }
                }
            });
        }

        function buildProgressBar() {
            const bar = document.getElementById('progress-bar');
            bar.innerHTML = steps.map((s, i) => 
                '<button onclick="goToStep(' + i + ')" class="step-pill px-3 py-1 text-[10px] font-mono font-bold whitespace-nowrap text-slate-500 hover:text-slate-300 ' + (i === 0 ? 'active' : '') + '">' + s.badge + '</button>'
            ).join('');
        }

        function buildLayerPanel() {
            const groups = { root: 'layer-roots', medieval: 'layer-medieval', reformation: 'layer-reformation', modern: 'layer-modern' };
            Object.values(allLayers).forEach(function (l) {
                const container = document.getElementById(groups[l.type]);
                const el = document.createElement('div');
                el.id = 'layer-' + l.id;
                el.className = 'layer-item flex items-center gap-3 px-3 py-2 rounded border border-transparent cursor-pointer inactive';
                el.innerHTML = '<span class="w-1.5 h-1.5 rounded-full shrink-0 shadow-[0_0_8px_currentColor]" style="background:' + l.borderColor + '; color:' + l.borderColor + '"></span><div class="flex flex-col"><span class="text-xs font-bold text-slate-300">' + l.label + '</span><span class="text-[9px] text-slate-600 font-mono tracking-wider">' + l.desc + '</span></div>';
                el.onclick = function () { if (currentMode === 'custom') toggleLayer(l.id); };
                container.appendChild(el);
            });
        }

        function updateLayerPanel(activeIds) {
            Object.keys(allLayers).forEach(function (id) {
                const el = document.getElementById('layer-' + id);
                if (activeIds.includes(id)) {
                    el.classList.remove('inactive');
                    el.classList.add('selected');
                } else {
                    el.classList.add('inactive');
                    el.classList.remove('selected');
                }
            });
        }

        function toggleLayer(id) {
            if (customSelection.has(id)) customSelection.delete(id);
            else customSelection.add(id);
            updateCustomView();
        }

        function updateCustomView() {
            const ids = Array.from(customSelection);
            chartInstance.data.datasets = ids.map(function (id) { return getDataset(id); });
            chartInstance.update();
            updateLayerPanel(ids);
            document.getElementById('insight-text').innerHTML = generateInsight(ids);
            document.getElementById('insight-badge').textContent = ids.length + ' SELECT';
            
            if (ids.length > 0) {
                const firstId = ids[ids.length - 1]; 
                const idx = Object.keys(allLayers).indexOf(firstId) + 1;
                if (idx > 0 && idx < stepDescriptions.length) {
                    document.getElementById('detail-badge').textContent = allLayers[firstId].label;
                    document.getElementById('detail-title').textContent = '';
                    document.getElementById('detail-desc').innerHTML = stepDescriptions[idx];
                }
            } else {
                document.getElementById('detail-badge').textContent = 'COMPARE';
                document.getElementById('detail-title').textContent = '';
                document.getElementById('detail-desc').innerHTML = '<p class="text-slate-500 font-mono flex items-center gap-2"><span class="animate-pulse">_</span> SELECT LAYERS TO ANALYZE</p>';
            }
        }

        function switchMode(mode) {
            currentMode = mode;
            const btnStory = document.getElementById('btn-mode-story');
            const btnCustom = document.getElementById('btn-mode-custom');
            
            if (mode === 'story') {
                btnStory.classList.add('bg-indigo-600', 'text-white', 'shadow-neon');
                btnStory.classList.remove('text-slate-500', 'hover:text-slate-300');
                btnCustom.classList.remove('bg-indigo-600', 'text-white', 'shadow-neon');
                btnCustom.classList.add('text-slate-500', 'hover:text-slate-300');
                
                document.getElementById('story-nav').style.display = 'flex';
                document.getElementById('progress-bar').style.display = 'flex';
                document.getElementById('layer-mode-hint').textContent = 'STATUS: AUTO_PILOT_ENGAGED';
                customSelection.clear();
                updateView();
            } else {
                btnCustom.classList.add('bg-indigo-600', 'text-white', 'shadow-neon');
                btnCustom.classList.remove('text-slate-500', 'hover:text-slate-300');
                btnStory.classList.remove('bg-indigo-600', 'text-white', 'shadow-neon');
                btnStory.classList.add('text-slate-500', 'hover:text-slate-300');
                
                document.getElementById('story-nav').style.display = 'none';
                document.getElementById('progress-bar').style.display = 'none';
                document.getElementById('layer-mode-hint').textContent = 'STATUS: MANUAL_OVERRIDE';
                updateCustomView();
            }
        }

        function updateView() {
            const step = steps[currentStep];
            chartInstance.data.datasets = step.layers.map(function (id) { return getDataset(id); });
            chartInstance.update();
            updateLayerPanel(step.layers);
            document.getElementById('insight-text').innerHTML = storyInsights[currentStep];
            document.getElementById('insight-badge').textContent = '0' + (currentStep + 1) + ' / ' + steps.length;
            document.getElementById('detail-badge').textContent = step.badge;
            document.getElementById('detail-title').textContent = step.title;
            document.getElementById('detail-desc').innerHTML = stepDescriptions[step.desc];
            document.querySelectorAll('.step-pill').forEach(function (el, i) { el.classList.toggle('active', i === currentStep); });
            document.getElementById('btn-prev').disabled = currentStep === 0;
            document.getElementById('btn-next').disabled = currentStep === steps.length - 1;
        }

        function goToStep(i) { currentStep = i; updateView(); }
        function nextStep() { if (currentStep < steps.length - 1) { currentStep++; updateView(); } }
        function prevStep() { if (currentStep > 0) { currentStep--; updateView(); } }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>